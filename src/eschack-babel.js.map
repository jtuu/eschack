{"version":3,"sources":["eschack.js"],"names":[],"mappings":"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","file":"eschack-babel.js","sourcesContent":["//Object.values polyfill\nif (!Object.values) {\n\tObject.values = obj => Object.keys(obj).map(key => obj[key]);\n}\n\n(function(global) {\n\t\"use strict\";\n\n\t//should these be scopewide?\n\tconst env = \"prod\",\n\t\tTICK = 1,\n\t\tsaveName = \"eschack_save\",\n\t\tmainCanvas = document.getElementById(\"canvas-main\"),\n\t\tsecondCanvas = document.getElementById(\"canvas-second\"),\n\t\tw = 1040,\n\t\th = 520;\n\tmainCanvas.width = w;\n\tmainCanvas.height = h;\n\tsecondCanvas.width = w;\n\tsecondCanvas.height = h;\n\tconst mainCtx = mainCanvas.getContext(\"2d\"),\n\t\tsecondCtx = secondCanvas.getContext(\"2d\");\n\tmainCtx.font = \"20px Consolas\";\n\tmainCtx.textAlign = \"center\";\n\n\tlet objectCounter = 0;\n\n\t//just a xy point\n\tconst Point = class Point {\n\t\tconstructor(x, y) {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t}\n\n\t\t//set values from array input\n\t\tset(arr) {\n\t\t\tthis.x = arr[0];\n\t\t\tthis.y = arr[1];\n\t\t}\n\n\t\t//get get get get got got got got\n\t\t//return xy as array\n\t\tget get() {\n\t\t\treturn [this.x, this.y];\n\t\t}\n\n\t\t//relative move\n\t\tmoveBy(vector) {\n\t\t\tlet [x, y] = vector.get;\n\t\t\tthis.x += x;\n\t\t\tthis.y += y;\n\t\t}\n\n\t\t//get manhattan distance vector between two points\n\t\tstatic distance(point1, point2) {\n\t\t\treturn new Vector(\n\t\t\t\tpoint2.x - point1.x,\n\t\t\t\tpoint2.y - point1.y\n\t\t\t);\n\t\t}\n\n\t\t//compare two points\n\t\tstatic equal(point1, point2) {\n\t\t\treturn point1.x === point2.x && point1.y === point2.y;\n\t\t}\n\t\t\n\t\t//check if point is inside given bounds\n\t\tin(bounds){\n\t\t\treturn this.x >= bounds.x && this.x <= bounds.x + bounds.w && this.y >= bounds.y && this.y <= bounds.y + bounds.h;\n\t\t}\n\t};\n\n\tconst Vector = class Vector {\n\t\tconstructor(u, v) {\n\t\t\t//if no arguments, use random values in [-1, 0, 1]\n\t\t\tthis.u = isNaN(u) ? Math.sign(Math.random() * 10 - 5) : u;\n\t\t\tthis.v = isNaN(v) ? Math.sign(Math.random() * 10 - 5) : v;\n\t\t}\n\n\t\tset(arr) {\n\t\t\tthis.u = arr[0];\n\t\t\tthis.v = arr[1];\n\t\t}\n\n\t\tget get() {\n\t\t\treturn [this.u, this.v];\n\t\t}\n\n\t\t//basically this just sets the larger\n\t\t//absolute value to 1 and the smaller to 0\n\t\treduce() {\n\t\t\tlet vals = this.get;\n\t\t\tlet absmax = Math.max.apply(null, vals.map(Math.abs));\n\t\t\tthis.set(vals.map(v => Math.round(v / absmax)));\n\t\t}\n\t};\n\n\t//tiles have constant positions and they contain gameobjects\n\t//they live in TileGroups\n\t//perhaps this should extend GameObject?\n\tconst Tile = class Tile {\n\t\tconstructor(point, ...contents) {\n\t\t\tthis.position = point;\n\t\t\tthis.contents = [];\n\t\t}\n\n\t\t//check if tile has anything in it\n\t\tget isEmpty() {\n\t\t\treturn this.contents.length === 0;\n\t\t}\n\n\t\t//add object to tiles container\n\t\tadd(obj) {\n\t\t\tif (!obj instanceof GameObject) throw new TypeError(\"Added object must be of type GameObject.\");\n\t\t\tif(obj.isMoveBlocking){\n\t\t\t\tthis.contents.unshift(obj);\n\t\t\t}else{\n\t\t\t\tthis.contents.push(obj);\n\t\t\t}\n\t\t}\n\n\t\t//remove from tiles container\n\t\tremove(obj) {\n\t\t\tlet index = this.contents.indexOf(obj);\n\t\t\tif(index > -1){\n\t\t\t\tthis.contents.splice(index, 1);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\t//get the first object in container\n\t\tget top() {\n\t\t\treturn this.contents[0];\n\t\t}\n\n\t\t//remove everything from container\n\t\tempty() {\n\t\t\tthis.contents = [];\n\t\t}\n\n\t\t//get all contents\n\t\tget get() {\n\t\t\treturn this.contents;\n\t\t}\n\n\t\ttoString() {\n\t\t\treturn \"Floor\";\n\t\t}\n\t};\n\n\t//board, level, grid, matrix... w/e\n\t//we're calling it a TileGroup now!\n\t//it's the thing where tiles exist\n\t//empty cells are null while invalid cells are ofc undefined\n\t//todo: use some kind of EmptyTile object instead of null?\n\tconst TileGroup = class TileGroup {\n\t\tconstructor(matrix, options) {\n\n\t\t\t//set all options to props\n\t\t\t//kinda unsafe lol\n\t\t\tfor (let key in options) {\n\t\t\t\tthis[key] = options[key];\n\t\t\t}\n\n\t\t\t//check if matrix was given or do we need to generate one\n\t\t\tif (matrix) {\n\t\t\t\tthis.matrix = matrix;\n\t\t\t\tthis.w = this.matrix[0].length;\n\t\t\t\tthis.h = this.matrix.length;\n\t\t\t} else {\n\t\t\t\tthis.matrix = [];\n\t\t\t\tfor (let y = 0; y < this.h; y++) {\n\t\t\t\t\tthis.matrix[y] = [];\n\t\t\t\t\tfor (let x = 0; x < this.w; x++) {\n\t\t\t\t\t\tthis.matrix[y][x] = new Tile(new Point(x, y));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//padding and shifting\n\t\t\t//basically this just translates the matrix to \"global\" coords\n\t\t\t//padding adds empty entries to the arrays\n\t\t\t//shifting shifts them\n\t\t\tif (this.origin.x >= 0) {\n\t\t\t\t//pad x\n\t\t\t\tthis.matrix.forEach((row, y) => this.matrix[y] = Array(this.origin.x).concat(this.matrix[y]));\n\t\t\t} else {\n\t\t\t\t//shift x\n\t\t\t\tthis.matrix.forEach((row, y) => {\n\t\t\t\t\tfor (let i = 0; i < -this.origin.x; i++) {\n\t\t\t\t\t\tthis.matrix[y].shift();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (this.origin.y >= 0) {\n\t\t\t\t//pad y\n\t\t\t\tthis.matrix = Array(this.origin.y).concat(this.matrix);\n\t\t\t} else {\n\t\t\t\t//shift y\n\t\t\t\tfor (let i = 0; i < -this.origin.y; i++) {\n\t\t\t\t\tthis.matrix.shift();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//some props require defaults\n\t\t\tthis.baseColor = this.baseColor || \"slategrey\";\n\t\t\tthis.tileSize = this.tileSize || 25;\n\t\t\tthis.spacing = this.spacing || 1;\n\t\t}\n\n\t\t//look up each cell and update gameobject positions in tiles\n\t\tupdate() {\n\t\t\tthis.matrix.forEach((row, y) => row.forEach((tile, x) => {\n\t\t\t\tif (tile && !tile.isEmpty) {\n\t\t\t\t\tlet temp = tile.top;\n\t\t\t\t\ttile.contents.shift();\n\t\t\t\t\tthis.insert(temp);\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\t//insert gameobject\n\t\tinsert(obj) {\n\t\t\tlet [x, y] = obj.position.get;\n\t\t\tif (this.has(obj.position)) {\n\t\t\t\tthis.matrix[y][x].add(obj);\n\t\t\t}\n\t\t}\n\n\t\t//returns the real coordinates and size of the matrix\n\t\tget bounds() {\n\t\t\treturn {\n\t\t\t\tx: this.origin.x * (this.tileSize + this.spacing),\n\t\t\t\ty: this.origin.y * (this.tileSize + this.spacing),\n\t\t\t\tw: this.w * (this.tileSize + this.spacing) - this.spacing,\n\t\t\t\th: this.h * (this.tileSize + this.spacing) - this.spacing\n\t\t\t};\n\t\t}\n\n\t\t//remove gameobject\n\t\tremove(obj) {\n\t\t\tlet [x, y] = obj.position.get;\n\t\t\tif (this.has(obj.position)) {\n\t\t\t\tthis.matrix[y][x].remove(obj);\n\t\t\t}\n\t\t}\n\n\t\t//turn everything into null\n\t\t//is this needed?\n\t\t//does this even work?\n\t\tclear() {\n\t\t\tthis.matrix.forEach(row => row.forEach(tile => tile.empty()));\n\t\t}\n\n\t\t//check if point exists in matrix\n\t\thas(point) {\n\t\t\tlet [x, y] = point.get;\n\t\t\treturn (!!this.matrix[y] && !!this.matrix[y][x]);\n\t\t}\n\n\t\t//get tile at point\n\t\tget(point) {\n\t\t\tlet [x, y] = point.get;\n\t\t\treturn this.has(point) ? this.matrix[y][x] : undefined;\n\t\t}\n\n\t\t//go through matrix and draw each cell\n\t\tdraw() {\n\t\t\tthis.matrix.forEach((row, y) => row.forEach((tile, x) => {\n\t\t\t\tif (tile) {\n\t\t\t\t\tlet [tx, ty] = tile.position.get;\n\t\t\t\t\tif (tile.isEmpty) {\n\t\t\t\t\t\t//default\n\t\t\t\t\t\tmainCtx.fillStyle = this.baseColor;\n\t\t\t\t\t\tmainCtx.fillRect(\n\t\t\t\t\t\t\ttx * (this.tileSize + this.spacing),\n\t\t\t\t\t\t\tty * (this.tileSize + this.spacing),\n\t\t\t\t\t\t\tthis.tileSize,\n\t\t\t\t\t\t\tthis.tileSize\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//draw gameobject\n\t\t\t\t\t\tmainCtx.fillStyle = tile.top.bgColor;\n\t\t\t\t\t\tmainCtx.fillRect(\n\t\t\t\t\t\t\ttx * (this.tileSize + this.spacing),\n\t\t\t\t\t\t\tty * (this.tileSize + this.spacing),\n\t\t\t\t\t\t\tthis.tileSize,\n\t\t\t\t\t\t\tthis.tileSize\n\t\t\t\t\t\t);\n\t\t\t\t\t\tmainCtx.fillStyle = tile.top.color;\n\t\t\t\t\t\tmainCtx.fillText(\n\t\t\t\t\t\t\ttile.top.glyph,\n\t\t\t\t\t\t\ttx * (this.tileSize + this.spacing) + this.tileSize / 2,\n\t\t\t\t\t\t\tty * (this.tileSize + this.spacing) + this.tileSize / 1.5\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t};\n\n\t//basically any gameobject that takes up a whole tile is a GameObject\n\t//this is the base class so uhhh let's not allow instantiation\n\tconst GameObject = class GameObject {\n\t\tconstructor(position) {\n\t\t\tif(this.constructor === GameObject){\n\t\t\t\tthrow new TypeError(\"GameObject is abstract\");\n\t\t\t}\n\t\t\t/*\n\t\t\tif (new.target === GameObject) {\n\t\t\t\tthrow new TypeError(\"GameObject is abstract\");\n\t\t\t}\n\t\t\t*/\n\t\t\tthis.id = objectCounter;\n\t\t\tobjectCounter += 1;\n\t\t\tthis.position = position;\n\t\t\tthis.bgColor = \"magenta\";\n\t\t\tthis.glyph = \"\\u26a0\"; //cool warning sign character (?)\n\t\t\tthis.color = \"black\";\n\t\t\tthis.flavorName = \"OBJ\"; //name mainly used in log messages\n\t\t\tthis.type = this.constructor.name; //used in identifying objects when loading from json\n\t\t}\n\n\t\tupdate() {\n\t\t\tconsole.warn(\"Unimplemented method 'update' in \" + this.constructor.name);\n\t\t}\n\n\t\tget isAlive() {\n\t\t\treturn this.hasOwnProperty(\"stats\") ? this.stats.HP > 0 : true;\n\t\t}\n\n\t\t//recreate class from plain obj\n\t\tstatic from(obj) {\n\t\t\tlet newObj = new this(new Point(obj.position.x, obj.position.y), obj.stats);\n\n\t\t\tlet exempt = [\"lifebar\", \"position\"];\n\n\t\t\tfor (let key in obj) {\n\t\t\t\tif (!exempt.includes(key)) {\n\t\t\t\t\tnewObj[key] = obj[key];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn newObj;\n\t\t}\n\n\t\ttoString() {\n\t\t\treturn this.type;\n\t\t}\n\t};\n\t\n\tconst MoveBlocking = Base => class extends Base{\n\t\tget isMoveBlocking(){\n\t\t\treturn true;\n\t\t}\n\t};\n\tconst VisionBlocking = Base => class extends Base{\n\t\tget isVisionBlocking(){\n\t\t\treturn true;\n\t\t}\n\t};\n\t\n\tconst Hittable = Base => class extends Base{\n\t\ttakeDamage(damage, logger) {\n\t\t\tthis.stats.HP -= damage;\n\t\t\tif (this.lifebar) this.lifebar.set(this.stats.HP);\n\t\t\tif (this.stats.HP <= 0) {\n\t\t\t\tthis.die(logger);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tdie(logger) {\n\t\t\tif(logger)logger.log(this.flavorName + \" died\", \"death\");\n\t\t\tif(this.lifebar)this.lifebar.remove();\n\t\t}\n\t\t\n\t\tget isHittable(){\n\t\t\treturn true;\n\t\t}\n\t};\n\n\t//todo: create base class Inanimate or something\n\tconst Wall = class Wall extends VisionBlocking(MoveBlocking(GameObject)) {\n\t\tconstructor(position) {\n\t\t\tsuper(position);\n\t\t\tthis.bgColor = \"hsl(0,0%,15%)\";\n\t\t\tthis.glyph = \"\\u2589\"; //some block character\n\t\t\tthis.color = \"hsl(0,0%,25%)\";\n\t\t\tthis.flavorName = \"wall\";\n\t\t}\n\n\t\tupdate() {\n\t\t\treturn 0;\n\t\t}\n\t};\n\n\n\t//any living dead undead whatever creature\n\tconst Creature = class Creature extends Hittable(MoveBlocking(GameObject)) {\n\t\tconstructor(position, stats, weapon) {\n\t\t\tsuper(position);\n\t\t\t//actions actually contains arrays of actions\n\t\t\tthis.actions = [];\n\n\t\t\tthis.stats = stats || {\n\t\t\t\t\"maxHP\": 3,\n\t\t\t\t\"HP\": 3,\n\t\t\t\t\"viewDistance\": 5,\n\t\t\t\t\"moveSpeed\": 10,\n\t\t\t\t\"inventorySize\": 5\n\t\t\t};\n\t\t\tthis.weapon = weapon || new Weapon(\"Claws\");\n\t\t\tthis.inventory = [this.weapon];\n\n\t\t\tthis.flavorName = \"creature\";\n\t\t\tthis.flavor = \"It is mundane.\"; //flavor text used in examine\n\t\t}\n\n\t\t//oh boy\n\t\tupdate(logger, time = 0) {\n\n\t\t\tlet updateCount = 0,\n\t\t\t\telapsedTime = 0;\n\t\t\n\t\t\t//go through all the possible actions given by actionmanager and\n\t\t\t//test their logic in the gameobjects context\n\t\t\t//they should already be in prioritized order so\n\t\t\t//we just use the first one that succeeds\n\t\t\tthis.actions.forEach(proposals => {\n\t\t\t\t//actually they contain functions that create the action instances so yeah\n\t\t\t\ttry {\n\t\t\t\t\tlet chosen;\n\t\t\t\t\t\n\t\t\t\t\tproposals.some(p => {\n\t\t\t\t\t\tlet action = p();\n\t\t\t\t\t\tif(action.try(this, time)){\n\t\t\t\t\t\t\tchosen = action;\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\telapsedTime += chosen.do(this);\n\t\t\t\t\tupdateCount++;\n\t\t\t\t} catch (err) {\n\t\t\t\t\t//console.warn(\"None of the proposed actions were suitable for \" + this.constructor.name);\n\t\t\t\t\t//console.log(err);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tfor(let i = 0; i < updateCount; i++){\n\t\t\t\tthis.actions.shift();\n\t\t\t}\n\n\t\t\treturn elapsedTime;\n\t\t}\n\n\t\ttoString() {\n\t\t\treturn this.type + \"<br>\" + this.stats.HP + \" HP<br>\" + this.flavor + \"<br>\" + this.weapon.damage + \" ATT\";\n\t\t}\n\t};\n\n\tconst Player = class Player extends Creature {\n\t\tconstructor(position, stats) {\n\t\t\tsuper(position, stats, new Weapon(\"Dagger\", 1, 5));\n\t\t\tthis.actions = [];\n\t\t\tthis.bgColor = \"white\";\n\t\t\tthis.glyph = \"@\";\n\t\t\tthis.color = \"black\";\n\n\t\t\tthis.stats.maxHP = 50;\n\t\t\tthis.stats.HP = 50;\n\t\t\tthis.stats.viewDistance = 8;\n\t\t\tthis.stats.moveSpeed = 10;\n\t\t\t//this.stats.inventorySize = 15;\n\t\t\t\n\t\t\tthis.stats = stats || this.stats;\n\n\t\t\tthis.lifebar = new Lifebar(this.id, \"Hero\", document.getElementById(\"info-container-player\"), this.stats.maxHP, this.stats.HP);\n\t\t\tthis.flavorName = \"you\";\n\t\t\tthis.flavor = \"Hi mom!\";\n\t\t\t//todo: store username here?\n\t\t}\n\t};\n\n\t//maybe this should be abstract\n\tconst Enemy = class Enemy extends Creature {\n\t\tconstructor(position, stats) {\n\t\t\tsuper(position, stats, new Weapon(\"Claws\", 2, 10));\n\t\t\tthis.actions = [];\n\t\t\tthis.bgColor = \"hsl(30, 30%, 45%)\";\n\t\t\tthis.glyph = \"E\";\n\t\t\tthis.color = \"white\";\n\n\t\t\tthis.stats.maxHP = 3;\n\t\t\tthis.stats.HP = 3;\n\t\t\tthis.stats.viewDistance = 7;\n\t\t\tthis.stats.moveSpeed = 9;\n\t\t\t\n\t\t\tthis.stats = stats || this.stats;\n\n\t\t\tthis.lifebar = new Lifebar(this.id, \"Enemy\", document.getElementById(\"info-container-other-life\"), this.stats.maxHP, this.stats.HP);\n\t\t\tthis.flavorName = \"the enemy\";\n\t\t\tthis.flavor = \"It has a fearsome visage.\";\n\t\t}\n\n\t\ttoString() {\n\t\t\treturn this.type + \"<br>\" + this.stats.HP + \" HP<br>\" + this.flavor + \"<br>\" + this.weapon.damage + \" ATT<br>\" + (this.noticed ? \"It has noticed you.\" : \"It has not noticed you.\");\n\t\t}\n\t};\n\t\n\tconst Item = class Item extends GameObject{\n\t\tconstructor(position){\n\t\t\tsuper(position);\n\t\t}\n\t\t\n\t\tupdate(){\n\t\t\treturn true;\n\t\t}\n\t};\n\t\n\tconst Weapon = class Weapon extends Item{\n\t\t//todo: basespeed (weight?), special properties (cleave, reach)\n\t\t//stuff\n\t\tconstructor(name, damage, speed) {\n\t\t\tsuper(null);\n\t\t\tthis.damage = damage || 1;\n\t\t\tthis.speed = speed || 10;\n\t\t\tthis.name = name;\n\t\t}\n\t\t\n\t\ttoString(){\n\t\t\treturn `${this.name} (${this.damage}, ${this.speed})`;\n\t\t}\n\t};\n\n\t//these contain the logic for actions but they will be used on the actor\n\t//the context shouldnt be changed but the action can be reused\n\t//even on different actors\n\t//maybe these should be stored in a pool somewhere...?\n\tconst Action = class Action {\n\t\tconstructor(context, logger) {\n\t\t\tif(this.constructor === GameObject){\n\t\t\t\tthrow new TypeError(\"Action is abstract\");\n\t\t\t}\n\t\t\t/*\n\t\t\tif (new.target === Action) {\n\t\t\t\tthrow new TypeError(\"Action is abstract\");\n\t\t\t}\n\t\t\t*/\n\t\t\t//the context or the state that the actor will act upon, eg. the board, a menu etc\n\t\t\tthis.context = context;\n\t\t\tthis.logger = logger;\n\t\t}\n\n\t\t//test if action can be done\n\t\ttry (actor) {\n\t\t\tconsole.warn(\"Unimplemented method '\" + arguments.callee + \"' in \" + this.constructor.name);\n\t\t}\n\n\t\t//execute action\n\t\tdo(actor) {\n\t\t\tconsole.warn(\"Unimplemented method '\" + arguments.callee + \"' in \" + this.constructor.name);\n\t\t}\n\t};\n\n\t//doesnt do anything\n\tconst NullAction = class NullAction extends Action {\n\t\tconstructor(context, logger) {\n\t\t\tsuper(context, logger);\n\t\t}\n\n\t\ttry (actor, time) {\n\t\t\treturn time % 10 === 0;\n\t\t}\n\n\t\tdo(actor) {\n\t\t\treturn 10;\n\t\t}\n\t};\n\n\t//the act of moving something somewhere\n\t//menu logic not done yet but maybe this could be used for menus too\n\tconst MoveAction = class MoveAction extends Action {\n\t\tconstructor(context, logger, movement) {\n\t\t\tsuper(context, logger);\n\t\t\tthis.movement = movement;\n\t\t}\n\n\t\ttry (actor, time) {\n\t\t\tthis.duration = actor.stats.moveSpeed;\n\t\t\tif(time % this.duration !== 0){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t//check if the point we're trying to move to is empty\n\t\t\tlet target = new Point(...actor.position.get);\n\t\t\ttarget.moveBy(this.movement);\n\t\t\tlet tile = this.context.get(target);\n\t\t\treturn tile.isEmpty || (tile && tile.top && !tile.top.isMoveBlocking);\n\t\t}\n\n\t\tdo(actor) {\n\t\t\tactor.position.moveBy(this.movement);\n\t\t\tthis.context.update(); //this is kinda important, should this even be here\n\t\t\treturn this.duration;\n\t\t}\n\t};\n\n\tconst AttackAction = class AttackAction extends Action {\n\t\tconstructor(context, logger, direction) {\n\t\t\tsuper(context, logger);\n\t\t\tthis.direction = direction;\n\t\t}\n\n\t\ttry (actor, time) {\n\t\t\tthis.duration = actor.weapon.speed;\n\t\t\tif(time % this.duration !== 0){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tlet target = new Point(...actor.position.get);\n\t\t\ttarget.moveBy(this.direction);\n\t\t\t\n\t\t\tlet tile = this.context.get(target);\n\t\t\treturn tile && tile.top && tile.top.isHittable;\n\t\t}\n\n\t\tdo(actor) {\n\t\t\tlet target = new Point(...actor.position.get);\n\t\t\ttarget.moveBy(this.direction);\n\t\t\ttarget = this.context.get(target);\n\n\t\t\tif(this.logger){\n\t\t\t\tthis.logger.log(actor.flavorName + \" hit \" + target.top.flavorName + \" for \" + actor.weapon.damage + \" damage with \" + actor.weapon, (actor.constructor === Player ? \"hit\" : \"damage\"));\n\t\t\t}\n\t\t\tlet died = target.top.takeDamage(actor.weapon.damage, this.logger);\n\t\t\tif (died) {\n\t\t\t\tthis.context.remove(target.top);\n\t\t\t}\n\t\t\tthis.context.update();\n\t\t\treturn this.duration;\n\t\t}\n\t};\n\t\n\tconst ItemPickupAction = class ItemPickupAction extends Action {\n\t\tconstructor(context, logger){\n\t\t\tsuper(context, logger);\n\t\t}\n\t\t\n\t\ttry(actor, time){\n\t\t\treturn time % 10 === 0 && actor.inventory.length < actor.stats.inventorySize && this.context.get(actor.position).contents.some(obj => obj instanceof Item);\n\t\t}\n\t\t\n\t\tdo(actor){\n\t\t\tlet targetTile = this.context.get(actor.position),\n\t\t\t\titem = targetTile.contents.find(obj => obj instanceof Item);\n\t\t\tactor.inventory.push(item);\n\t\t\ttargetTile.remove(item);\n\t\t\tif(this.logger){\n\t\t\t\tthis.logger.log(actor.flavorName + \" picked up \" + item.flavorName);\n\t\t\t}\n\t\t\treturn 10;\n\t\t}\n\t};\n\n\tconst ItemDropAction = class ItemDropAction extends Action {\n\t\tconstructor(context, logger, inventorySlot){\n\t\t\tsuper(context, logger);\n\t\t\tthis.inventorySlot = inventorySlot;\n\t\t}\n\t\t\n\t\ttry(actor, time){\n\t\t\tlet hasItem = !!actor.inventory[Utils.alphabetMap.indexOf(this.inventorySlot)];\n\t\t\tif(!hasItem){\n\t\t\t\tthis.logger.log(\"No such item\");\n\t\t\t}\n\t\t\treturn time % 10 === 0 && hasItem;\n\t\t}\n\t\t\n\t\tdo(actor){\n\t\t\tlet index = Utils.alphabetMap.indexOf(this.inventorySlot),\n\t\t\t\titem = actor.inventory[index];\n\t\t\tactor.inventory.splice(index, 1);\n\t\t\titem.position = new Point(...actor.position.get);\n\t\t\tthis.context.insert(item);\n\t\t\treturn 10;\n\t\t}\n\t};\n\t\n\tconst Lifebar = class Lifebar {\n\t\tconstructor(id, name, container, max, value) {\n\t\t\tthis.id = id;\n\t\t\tthis.name = name;\n\t\t\tthis.max = max;\n\t\t\tthis.value = value || max;\n\n\t\t\tthis.container = container;\n\n\t\t\tlet label = document.createElement(\"label\");\n\t\t\tlabel.setAttribute(\"for\", \"bar-lifebar-\" + this.name + \"-\" + this.id);\n\t\t\tlabel.innerHTML = this.name;\n\t\t\tthis.label = label;\n\n\t\t\tlet bar = document.createElement(\"div\");\n\t\t\tbar.className = \"bar bar-lifebar\";\n\t\t\tbar.id = \"bar-lifebar-\" + this.name + \"-\" + this.id;\n\t\t\tthis.bar = bar;\n\n\t\t\tthis.set();\n\n\t\t\tthis.container.appendChild(label);\n\t\t\tthis.label.appendChild(bar);\n\t\t}\n\n\t\tset(value) {\n\t\t\tif (!isNaN(value)) {\n\t\t\t\tthis.value = value;\n\t\t\t}\n\t\t\tthis.bar.setAttribute(\"data-content\", this.value + \"/\" + this.max);\n\n\t\t\t//approximate visual size, range [0...100]\n\t\t\t//do we need more precision? is this too much precision?\n\t\t\tlet sizeClass = \"bar-size-\" + Math.max(Math.floor(this.value / this.max * 100), 0);\n\t\t\tif (this.bar.className.match(/size/)) {\n\t\t\t\tthis.bar.className = this.bar.className.replace(/bar-size-[0-9]{1,3}/, sizeClass);\n\t\t\t} else {\n\t\t\t\tthis.bar.classList.add(sizeClass);\n\t\t\t}\n\t\t}\n\n\t\tsetStyle(style) {\n\t\t\tlet styles = {\n\t\t\t\t\"hilight\": \"hilighted\",\n\t\t\t\t\"default\": \"default\"\n\t\t\t};\n\t\t\tstyle = styles[style];\n\t\t\tif (style) {\n\t\t\t\t//remove other styles\n\t\t\t\tObject.values(styles).filter(v => v !== style).forEach(f => {\n\t\t\t\t\tthis.bar.classList.remove(f);\n\t\t\t\t\tthis.label.classList.remove(f);\n\t\t\t\t});\n\n\t\t\t\tthis.bar.classList.add(style);\n\t\t\t\tthis.label.classList.add(style);\n\t\t\t}\n\t\t}\n\n\t\t//remove from dom\n\t\tremove() {\n\t\t\tthis.bar.remove();\n\t\t\tthis.label.remove();\n\t\t}\n\n\t\thide() {\n\t\t\tthis.bar.style.display = \"none\";\n\t\t\tthis.label.style.display = \"none\";\n\t\t}\n\n\t\tshow() {\n\t\t\tthis.bar.style.display = \"\";\n\t\t\tthis.label.style.display = \"\";\n\t\t}\n\t};\n\n\n\t//handle key related stuff and i guess also some action mapping lol\n\tconst KeyHandler = class KeyHandler {\n\t\tconstructor() {\n\t\t\tthis.use(\"default\");\n\t\t}\n\t\t\n\t\tuse(map = \"default\"){\n\t\t\tif(map ===\"default\"){\n\t\t\t\tthis.using = \"default\";\n\t\t\t\t\n\t\t\t\tthis.keyCases = {\n\t\t\t\t\t104: \"n\",\n\n\t\t\t\t\t100: \"w\",\n\n\t\t\t\t\t98: \"s\",\n\n\t\t\t\t\t102: \"e\",\n\n\t\t\t\t\t105: \"ne\",\n\t\t\t\t\t99: \"se\",\n\t\t\t\t\t97: \"sw\",\n\t\t\t\t\t103: \"nw\",\n\n\t\t\t\t\t101: \"c\",\n\t\t\t\t\t\n\t\t\t\t\t\"g\": \"pickup\",\n\t\t\t\t\t71: \"pickup\",\n\t\t\t\t\t\n\t\t\t\t\t68: \"dropdialog\"\n\t\t\t\t};\n\n\t\t\t\tthis.actionMap = {\n\t\t\t\t\t\"n\": () => new Vector(0, -1),\n\t\t\t\t\t\"w\": () => new Vector(-1, 0),\n\t\t\t\t\t\"s\": () => new Vector(0, 1),\n\t\t\t\t\t\"e\": () => new Vector(1, 0),\n\t\t\t\t\t\"ne\": () => new Vector(1, -1),\n\t\t\t\t\t\"se\": () => new Vector(1, 1),\n\t\t\t\t\t\"sw\": () => new Vector(-1, 1),\n\t\t\t\t\t\"nw\": () => new Vector(-1, -1),\n\t\t\t\t\t\"c\": null,\n\t\t\t\t\t\"pickup\": \"pickup\",\n\t\t\t\t\t\"dropdialog\": () => \"drop\"\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\t\n\t\t\t}else if(map === \"dropdialog\"){\n\t\t\t\tthis.using = \"dropdialog\";\n\t\t\t\tthis.keyCases = \"abcdefghijklmnopqrstuvwxyz\".split(\"\").reduce((p, c) => (p[c.toUpperCase().charCodeAt(0)] = c, p), {});\n\t\t\t}\n\t\t}\n\n\t\t//input is a key or a keycode\n\t\t//returns action instruction\n\t\tget(key) {\n\t\t\tif(this.keyCases[key] === \"dropdialog\"){\n\t\t\t\tthis.use(\"dropdialog\");\n\t\t\t\treturn \"drop\";\n\t\t\t}else if(this.using === \"dropdialog\"){\n\t\t\t\tlet val = this.keyCases[key];\n\t\t\t\tthis.use();\n\t\t\t\treturn \"drop:\"+val;\n\t\t\t}\n\t\t\treturn this.actionMap[this.keyCases[key]];\n\t\t}\n\t};\n\n\t//does gamelogic stuff\n\tconst ActionManager = class ActionManager {\n\t\tconstructor(board, logger) {\n\t\t\tthis.board = board;\n\t\t\tthis.logger = logger;\n\n\t\t\tthis.proposalMap = {};\n\t\t\tthis.proposalMap[Vector] = [MoveAction, AttackAction, NullAction];\n\t\t\tthis.proposalMap[\"pickup\"] = [ItemPickupAction, NullAction];\n\t\t\tthis.proposalMap[\"drop\"] = [ItemDropAction, NullAction];\n\t\t}\n\n\t\t//decide actor logic\n\t\tthink(actor, player) {\n\t\t\tif (actor instanceof Enemy) {\n\t\t\t\tlet fov = this.getFov(actor),\n\t\t\t\t\tinstruction = null,\n\t\t\t\t\tshouldLog = this.getFov(player).has(actor.position);\n\t\t\t\tactor.target = fov.get(player.position);\n\n\t\t\t\tif (!actor.target) {\n\t\t\t\t\t//cant find target, move randomly\n\t\t\t\t\tinstruction = new Vector();\n\t\t\t\t\tactor.noticed = false;\n\t\t\t\t} else if (Point.equal(actor.position, actor.target.position)) {\n\t\t\t\t\t//reached target, stopping\n\t\t\t\t\tactor.target = undefined;\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\t//moving towards target\n\t\t\t\t\tlet vector = Point.distance(actor.position, actor.target.position);\n\t\t\t\t\tvector.reduce();\n\t\t\t\t\tinstruction = vector;\n\t\t\t\t\tif (!actor.noticed && shouldLog) this.logger.log(actor.flavorName + \" noticed \" + player.flavorName);\n\t\t\t\t\tactor.noticed = true;\n\t\t\t\t}\n\n\t\t\t\tlet proposals = this.proposalMap[instruction.constructor];\n\t\t\t\tif (proposals) {\n\t\t\t\t\tlet methods = proposals.map(action => () => new action(this.board, (shouldLog ? this.logger : null), instruction));\n\t\t\t\t\tactor.actions.push(methods);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tgetFov(actor) {\n\t\t\tif(!actor)return;\n\t\t\tlet [ax, ay] = actor.position.get,\n\t\t\t\trange = actor.stats.viewDistance,\n\t\t\t\tquarters = {\n\t\t\t\t\t\"ne\": [],\n\t\t\t\t\t\"se\": [],\n\t\t\t\t\t\"sw\": [],\n\t\t\t\t\t\"nw\": []\n\t\t\t\t};\n\n\t\t\tfor (let y = 0; y < range; y++) {\n\t\t\t\tfor (let x = 0; x < range; x++) {\n\t\t\t\t\tif (!quarters.ne[y]) {\n\t\t\t\t\t\tquarters.ne[y] = [];\n\t\t\t\t\t\tquarters.se[y] = [];\n\t\t\t\t\t\tquarters.sw[y] = [];\n\t\t\t\t\t\tquarters.nw[y] = [];\n\t\t\t\t\t}\n\t\t\t\t\tquarters.ne[y][x] = this.board.get(new Point(ax + x, ay - range + y + 1));\n\t\t\t\t\tquarters.se[y][x] = this.board.get(new Point(ax + x, ay + y));\n\t\t\t\t\tquarters.sw[y][x] = this.board.get(new Point(ax - range + x + 1, ay + y));\n\t\t\t\t\tquarters.nw[y][x] = this.board.get(new Point(ax - range + x + 1, ay - range + y + 1));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tquarters.ne = Utils.rotate(Utils.beamcast(Utils.rotate(quarters.ne, 90)), -90);\n\t\t\tquarters.se = Utils.beamcast(quarters.se);\n\t\t\tquarters.sw = Utils.rotate(Utils.beamcast(Utils.rotate(quarters.sw, -90)), 90);\n\t\t\tquarters.nw = Utils.rotate(Utils.beamcast(Utils.rotate(quarters.nw, 180)), -180);\n\n\t\t\treturn new TileGroup(Utils.mergeQuarters(quarters), {\n\t\t\t\torigin: new Point(ax - range + 1, ay - range + 1),\n\t\t\t\tbaseColor: \"hsla(244,3%,55%,1)\",\n\t\t\t\ttileSize: 25,\n\t\t\t\tspacing: 1\n\t\t\t});\n\t\t}\n\n\t\t//what does this do again? give actions to actors? or just the player?\n\t\tdelegateAction(actor, instruction) {\n\t\t\tif(!actor){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (instruction) {\n\t\t\t\tlet key = instruction;\n\t\t\t\tif(typeof instruction === \"function\"){\n\t\t\t\t\tinstruction = instruction();\n\t\t\t\t\tkey = instruction.constructor;\n\t\t\t\t}else if(typeof instruction === \"string\"){\n\t\t\t\t\t[key, instruction] = instruction.split(\":\");\n\t\t\t\t\tif(key === \"drop\" && !instruction){\n\t\t\t\t\t\tthis.logger.log(\"Which item to drop? [a-z]\");\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet proposals = this.proposalMap[key];\n\t\t\t\tif (proposals) {\n\t\t\t\t\tlet methods = proposals.map(action => () => new action(this.board, this.logger, instruction));\n\t\t\t\t\tactor.actions.push(methods);\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\tconsole.warn(\"Could not delegate action: \", instruction, JSON.stringify(instruction));\n\t\t\t\t}\n\t\t\t} else if (instruction === null) {\n\t\t\t\tactor.actions.push([() => new NullAction(null, this.logger)]);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t};\n\n\tconst Utils = class Utils {\n\t\t\n\t\tstatic get exports(){\n\t\t\treturn {\n\t\t\t\t\"instance\": game,\n\t\t\t\t\"Creature\": Creature,\n\t\t\t\t\"Player\": Player,\n\t\t\t\t\"GameObject\": GameObject,\n\t\t\t\t\"Point\": Point,\n\t\t\t\t\"Vector\": Vector,\n\t\t\t\t\"ActionManager\": ActionManager,\n\t\t\t\t\"TileGroup\": TileGroup,\n\t\t\t\t\"Utils\": Utils,\n\t\t\t\t\"Tile\": Tile,\n\t\t\t\t\"Wall\": Wall\n\t\t\t};\n\t\t}\n\t\t\n\t\tstatic get alphabetMap(){\n\t\t\treturn [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\"];\n\t\t}\n\n\t\tstatic rotate(arr, angle) {\n\t\t\tif (angle === 90) {\n\t\t\t\treturn Utils.transpose(arr.reverse());\n\t\t\t} else if (angle === -90) {\n\t\t\t\treturn Utils.transpose(arr).reverse();\n\t\t\t} else if (angle === 180 || angle === -180) {\n\t\t\t\treturn Utils.transpose(Utils.transpose(arr).reverse()).reverse();\n\t\t\t} else {\n\t\t\t\tconsole.warn(\"Invalid angle\");\n\t\t\t\treturn arr;\n\t\t\t}\n\t\t}\n\n\t\t//http://stackoverflow.com/a/4492703\n\t\tstatic transpose(arr) {\n\t\t\tvar w = arr.length ? arr.length : 0,\n\t\t\t\th = arr[0] instanceof Array ? arr[0].length : 0;\n\n\t\t\tif (h === 0 || w === 0) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tvar i, j, t = [];\n\t\t\tfor (i = 0; i < h; i++) {\n\t\t\t\tt[i] = [];\n\t\t\t\tfor (j = 0; j < w; j++) {\n\t\t\t\t\tt[i][j] = arr[j][i];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn t;\n\t\t}\n\n\t\t//algorithm taken from here\n\t\t//http://www.roguebasin.com/index.php?title=Isaac_s_fast_beamcasting_LOS\n\t\t//and modified\n\t\tstatic beamcast(matrix) {\n\t\t\tlet visible = [];\n\t\t\tfor (let i = 0; i < matrix.length; i++) {\n\t\t\t\tvisible[i] = Array.from(Array(matrix.length));\n\t\t\t}\n\n\t\t\t//0,0 will always be visible\n\t\t\tvisible[0][0] = matrix[0][0];\n\n\t\t\t//check orthogonals\n\t\t\tlet ox = 0;\n\t\t\twhile (matrix[ox] && matrix[ox][0]) {\n\t\t\t\tvisible[ox][0] = matrix[ox][0];\n\t\t\t\tif (matrix[ox][0].top && matrix[ox][0].top.isVisionBlocking) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tox++;\n\t\t\t}\n\t\t\tlet oy = 0;\n\t\t\twhile (matrix[0] && matrix[0][oy]) {\n\t\t\t\tvisible[0][oy] = matrix[0][oy];\n\t\t\t\tif (matrix[0][oy].top && matrix[0][oy].top.isVisionBlocking) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\toy++;\n\t\t\t}\n\n\t\t\t//beams\n\t\t\tfor (let slope = 1, slopeCount = 31; slope <= slopeCount; slope++) {\n\t\t\t\tlet v = slope,\n\t\t\t\t\tmin = 0,\n\t\t\t\t\tmax = slopeCount;\n\t\t\t\tfor (let u = 0; min <= max; u++) {\n\t\t\t\t\tlet y = v >> 5,\n\t\t\t\t\t\tx = u - y,\n\t\t\t\t\t\tcor = slopeCount + 1 - (v & slopeCount),\n\t\t\t\t\t\tneedBreak = false;\n\n\t\t\t\t\tif (min < cor) {\n\t\t\t\t\t\tif (matrix[x] && matrix[x][y]) {\n\t\t\t\t\t\t\tvisible[x][y] = matrix[x][y];\n\t\t\t\t\t\t\tif (matrix[x][y].top && matrix[x][y].top.isVisionBlocking) {\n\t\t\t\t\t\t\t\tmin = cor;\n\t\t\t\t\t\t\t\tneedBreak = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmin = cor;\n\t\t\t\t\t\t\tneedBreak = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (max < cor) {\n\t\t\t\t\t\tif (matrix[x] && matrix[x][y]) {\n\t\t\t\t\t\t\tvisible[x][y] = matrix[x][y];\n\t\t\t\t\t\t\tif (matrix[x][y].top && matrix[x][y].top.isVisionBlocking) {\n\t\t\t\t\t\t\t\tmax = cor;\n\t\t\t\t\t\t\t\tneedBreak = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmax = cor;\n\t\t\t\t\t\t\tneedBreak = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tv += slope;\n\t\t\t\t\tif (needBreak) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn visible;\n\t\t}\n\n\t\tstatic mergeQuarters(quarters) {\n\t\t\t//quarters.nw + quarters.ne\n\t\t\t//            +\n\t\t\t//quarters.sw + quarters.se\n\n\t\t\tlet upper = quarters.nw.map((row, k) => {\n\t\t\t\t//pop last column of left because it is identical to the first column of right\n\t\t\t\trow.pop();\n\n\t\t\t\t//merge rows of left and right\n\t\t\t\treturn row.concat(quarters.ne[k]);\n\t\t\t});\n\n\t\t\tlet lower = quarters.sw.map((row, k) => {\n\t\t\t\trow.pop();\n\t\t\t\treturn row.concat(quarters.se[k]);\n\t\t\t});\n\n\t\t\t//pop last row of upper because it is identical to the first row of lower\n\t\t\tupper.pop();\n\n\t\t\t//merge upper and lower\n\t\t\treturn upper.concat(lower);\n\t\t}\n\t\t\n\t\tstatic saveGame(instance){\n\t\t\tlet save = {};\n\t\t\tsave.board = instance.board;\n\t\t\tsave.player = instance.player;\n\t\t\tsave.objs = instance.objs;\n\n\t\t\tsave = LZString.compress(JSON.stringify(save));\n\t\t\tlocalStorage.setItem(saveName, save);\n\t\t\tconsole.log(\"Game saved\");\n\t\t}\n\t\t\n\t\tstatic loadGame() {\n\t\t\tlet save = JSON.parse(LZString.decompress(localStorage.getItem(saveName)) || null);\n\n\t\t\tif (save) {\n\t\t\t\tlet objMap = {\n\t\t\t\t\t\"Wall\": Wall,\n\t\t\t\t\t\"Creature\": Creature,\n\t\t\t\t\t\"Enemy\": Enemy,\n\t\t\t\t\t\"Player\": Player\n\t\t\t\t};\n\t\t\t\tlet data = [];\n\t\t\t\tdata.push(new TileGroup(null, {\n\t\t\t\t\torigin: new Point(save.board.origin.x, save.board.origin.y),\n\t\t\t\t\tbaseColor: save.board.baseColor,\n\t\t\t\t\ttileSize: save.board.tileSize,\n\t\t\t\t\tspacing: save.board.spacing,\n\t\t\t\t\tw: save.board.w,\n\t\t\t\t\th: save.board.h\n\t\t\t\t}));\n\n\t\t\t\tlet objs = [];\n\t\t\t\tsave.objs.forEach(obj => {\n\t\t\t\t\tif (obj) {\n\t\t\t\t\t\tif (objMap[obj.type]) {\n\t\t\t\t\t\t\tobjs[obj.id] = objMap[obj.type].from(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tdata.push(objs);\n\n\t\t\t\tconsole.log(\"Savedata loaded\");\n\t\t\t\treturn new Game(...data);\n\t\t\t} else {\n\t\t\t\tconsole.log(\"No existing savedata found\");\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\t\n\t\tstatic deleteSave() {\n\t\t\tlocalStorage.removeItem(saveName);\n\t\t\tconsole.log(\"Savedata deleted\");\n\t\t};\n\t\t\n\t\t//convert screen coordinates to game coordinates\n\t\tstatic screenToGame(point, tileSize, spacing){\n\t\t\treturn new Point(Math.floor(point.x / (tileSize + spacing)), Math.floor(point.y / (tileSize + spacing)));\n\t\t}\n\t\t\n\t\t//convert game coordinates to screen coordinates\n\t\tstatic gameToScreen(point, tileSize, spacing){\n\t\t\treturn new Point(point.x * (tileSize + spacing), point.y * (tileSize + spacing));\n\t\t}\n\t\t\n\t\t//convert screen coordinates to conform to tiles\n\t\tstatic screenToTiles(point, tileSize, spacing){\n\t\t\treturn Utils.gameToScreen(Utils.screenToGame(point, tileSize, spacing), tileSize, spacing);\n\t\t}\n\n\t\tstatic exportObjs(exports) {\n\t\t\tfor (let key in exports) {\n\t\t\t\tglobal[key] = exports[key];\n\t\t\t}\n\t\t}\n\t\t\n\t\tstatic get DungeonGenerator(){\n\t\t\treturn class{\n\t\t\t\tstatic makeRoom(options){\n\t\t\t\t\tlet room = {};\n\t\t\t\t\t\n\t\t\t\t\troom.w = ~~(Math.random() * (options.rooms.size.max.w - options.rooms.size.min.w) + options.rooms.size.min.w);\n\t\t\t\t\troom.h = ~~(Math.random() * (options.rooms.size.max.h - options.rooms.size.min.h) + options.rooms.size.min.h);\n\t\t\t\t\troom.x = ~~(Math.random() * (options.size.w - room.w));\n\t\t\t\t\troom.y = ~~(Math.random() * (options.size.h - room.h));\n\t\t\t\t\t\n\t\t\t\t\treturn room;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tstatic makePoint(options){\n\t\t\t\t\treturn {\n\t\t\t\t\t\tx: ~~(Math.random() * options.size.w),\n\t\t\t\t\t\ty: ~~(Math.random() * options.size.h)\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tstatic makePaths(rooms, midPoints, options){\n\t\t\t\t\tlet paths = [];\n\t\t\t\t\t\n\t\t\t\t\t//connect rooms to midpoints\n\t\t\t\t\tfor(let i = 0; i < options.paths.count; i++){\n\t\t\t\t\t\tlet path = {},\n\t\t\t\t\t\t\tdest = midPoints[i % options.paths.count % options.midPoints.count];\n\t\t\t\t\t\t\t\n\t\t\t\t\t\tpath.x1 = rooms[i].x + ~~(Math.random() * rooms[i].w);\n\t\t\t\t\t\tpath.y1 = rooms[i].y + ~~(Math.random() * rooms[i].h);\n\n\t\t\t\t\t\tpath.x2 = dest.x;\n\t\t\t\t\t\tpath.y2 = rooms[i].y + ~~(Math.random() * rooms[i].h);\n\t\t\t\t\t\t\n\t\t\t\t\t\tpath.x3 = dest.x;\n\t\t\t\t\t\tpath.y3 = dest.y;\n\n\t\t\t\t\t\tpaths.push(path);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t//connect midpoints together\n\t\t\t\t\tfor (let i = 1; i < options.midPoints.count; i++) {\n\t\t\t\t\t\tlet path = {};\n\n\t\t\t\t\t\tpath.x1 = midPoints[i - 1].x;\n\t\t\t\t\t\tpath.y1 = midPoints[i - 1].y;\n\t\t\t\t\t\t\n\t\t\t\t\t\tpath.x2 = midPoints[i].x;\n\t\t\t\t\t\tpath.y2 = midPoints[i - 1].y;\n\n\t\t\t\t\t\tpath.x3 = midPoints[i].x;\n\t\t\t\t\t\tpath.y3 = midPoints[i].y;\n\n\t\t\t\t\t\tpaths.push(path);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn paths;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tstatic insertEnemies(room, options){\n\t\t\t\t\tlet enemies = [];\n\t\t\t\t\tfor(let x = room.x + room.w; x > room.x; x--){\n\t\t\t\t\t\tfor(let y = room.y + room.h; y > room.y; y--){\n\t\t\t\t\t\t\tif(Math.random() < options.enemies.spawnChance){\n\t\t\t\t\t\t\t\tenemies.push(new Enemy(new Point(x, y)));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn enemies;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tstatic makeDungeon(options){\n\t\t\t\t\toptions = options || this.defaultOptions;\n\t\t\t\t\tlet matrix = [],\n\t\t\t\t\t\tobjs = [],\n\t\t\t\t\t\trooms = Array(options.rooms.count).fill(),\n\t\t\t\t\t\tmidPoints = Array(options.midPoints.count).fill();\n\t\t\t\t\t\t\n\t\t\t\t\t\t//get rooms\n\t\t\t\t\t\tfor(let i in rooms){\n\t\t\t\t\t\t\trooms[i] = this.makeRoom(options);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t//place player in first room\n\t\t\t\t\t\tobjs.push(new Player(new Point(rooms[0].x+1, rooms[0].y+1)));\n\t\t\t\t\t\t\n\t\t\t\t\t\t//get midpoints\n\t\t\t\t\t\tfor(let i in midPoints){\n\t\t\t\t\t\t\tmidPoints[i] = this.makePoint(options);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t//get paths\n\t\t\t\t\t\tlet paths = this.makePaths(rooms, midPoints, options);\n\t\t\t\t\t\t\n\t\t\t\t\t\t//fill matrix with walls\n\t\t\t\t\t\tfor (let y = 0; y < options.size.h; y++) {\n\t\t\t\t\t\t\tmatrix[y] = [];\n\t\t\t\t\t\t\tfor (let x = 0; x < options.size.w; x++) {\n\t\t\t\t\t\t\t\tlet tile = new Tile(new Point(x, y));\n\t\t\t\t\t\t\t\ttile.add(new Wall(new Point(x, y)));\n\t\t\t\t\t\t\t\tmatrix[y][x] = tile;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t//carve out rooms\n\t\t\t\t\t\t//and try put some enemies in them\n\t\t\t\t\t\trooms.forEach(room => {\n\t\t\t\t\t\t\tfor(let x = room.x + room.w; x > room.x; x--){\n\t\t\t\t\t\t\t\tfor(let y = room.y + room.h; y > room.y; y--){\n\t\t\t\t\t\t\t\t\tmatrix[y][x].empty();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tobjs = objs.concat(this.insertEnemies(room, options));\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\t//carve out paths\n\t\t\t\t\t\tpaths.forEach(path => {\n\t\t\t\t\t\t\tfor(let i0 = Math.min(path.x1, path.x2), i1 = Math.max(path.x1, path.x2); i0 < i1; i0++){\n\t\t\t\t\t\t\t\tmatrix[path.y1][i0].empty();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfor(let i0 = Math.min(path.y2, path.y3), i1 = Math.max(path.y2, path.y3); i0 < i1; i0++){\n\t\t\t\t\t\t\t\tmatrix[i0][path.x2].empty();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\t//get objs\n\t\t\t\t\t\tfor (let y = 0; y < options.size.h; y++) {\n\t\t\t\t\t\t\tfor (let x = 0; x < options.size.w; x++) {\n\t\t\t\t\t\t\t\tif(!matrix[y][x].isEmpty){\n\t\t\t\t\t\t\t\t\tobjs.push(matrix[y][x].top);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn objs;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tstatic get defaultOptions(){\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsize: {\n\t\t\t\t\t\t\tw: 40,\n\t\t\t\t\t\t\th: 20\n\t\t\t\t\t\t},\n\t\t\t\t\t\trooms: {\n\t\t\t\t\t\t\tcount: 8,\n\t\t\t\t\t\t\tsize: {\n\t\t\t\t\t\t\t\tmax: {\n\t\t\t\t\t\t\t\t\tw: 8,\n\t\t\t\t\t\t\t\t\th: 8\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmin: {\n\t\t\t\t\t\t\t\t\tw: 3,\n\t\t\t\t\t\t\t\t\th: 3\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmidPoints: {\n\t\t\t\t\t\t\tcount: 2\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpaths: {\n\t\t\t\t\t\t\tcount: 8\n\t\t\t\t\t\t},\n\t\t\t\t\t\tenemies: {\n\t\t\t\t\t\t\tspawnChance: 0.05\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\t\n\t};\n\n\t//manages logging\n\tconst LogboxManager = class LogboxManager {\n\t\tconstructor(logbox, rowCount) {\n\t\t\tthis.logbox = logbox;\n\n\t\t\tthis.rowCount = rowCount;\n\t\t\tthis.rows = [];\n\t\t\tthis.messages = [];\n\n\t\t\tfor (let i = 0; i < this.rowCount; i++) {\n\t\t\t\tlet row = document.createElement(\"div\");\n\t\t\t\trow.className = \"logbox-row\";\n\t\t\t\trow.id = \"logbox-row-\" + (i + 1);\n\t\t\t\tthis.logbox.appendChild(row);\n\t\t\t\tthis.rows.push(row);\n\t\t\t}\n\t\t}\n\n\t\t//this handles inserting new messages and moving old etc\n\t\t//type is the css class used\n\t\tlog(text, type = \"default\") {\n\t\t\ttext = text.charAt(0).toUpperCase() + text.slice(1);\n\n\t\t\tlet msg = document.createElement(\"span\");\n\t\t\tmsg.className = \"logmsg logmsg-\" + type;\n\t\t\tmsg.innerHTML = text;\n\n\t\t\tthis.messages.push(msg);\n\n\t\t\tlet target = this.rows.find(row => row.children.length === 0);\n\n\t\t\tif (target) {\n\t\t\t\ttarget.appendChild(msg);\n\t\t\t} else {\n\t\t\t\tthis.rows[0].children[0].remove();\n\t\t\t\tthis.rows.forEach((row, index) => {\n\t\t\t\t\trow.appendChild(this.messages[this.messages.length - (this.rowCount - index)]);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\t\n\tconst InventoryManager = class InventoryManager{\n\t\tconstructor(inventoryBox, inventory){\n\t\t\tthis.wrapper = inventoryBox;\n\t\t\tthis.inventory = inventory;\n\t\t\tlet container = document.createElement(\"div\");\n\t\t\tcontainer.style.padding = \"10px\";\n\t\t\tthis.container = container;\n\t\t\tthis.wrapper.appendChild(this.container);\n\t\t}\n\t\t\n\t\tupdate() {\n\t\t\tif (!!this.container.children.length) {\n\t\t\t\tArray.from(this.container.children).forEach(item => item.remove());\n\t\t\t}\n\t\t\tthis.inventory.forEach((item, key) => {\n\t\t\t\tlet ele = document.createElement(\"div\");\n\t\t\t\tele.innerHTML = Utils.alphabetMap[key] + \" - \" + item;\n\t\t\t\tthis.container.appendChild(ele);\n\t\t\t});\n\t\t}\n\t};\n\n\t//handle mouse stuff and examine cursor\n\tconst MouseHandler = class MouseHandler {\n\t\tconstructor(board) {\n\t\t\tthis.board = board;\n\t\t\tlet cursor = document.createElement(\"div\");\n\t\t\tcursor.id = \"cursor\";\n\t\t\tcursor.style.width = this.board.tileSize + \"px\";\n\t\t\tcursor.style.height = this.board.tileSize + \"px\";\n\n\t\t\tthis.cursor = cursor;\n\t\t\tdocument.body.appendChild(this.cursor);\n\t\t}\n\n\t\t//set cursor position\n\t\t//input screen coordinates\n\t\tcursorFromScreen(point) {\n\t\t\tlet [x, y] = Utils.screenToTiles(point, this.board.tileSize, this.board.spacing).get;\n\t\t\tthis.cursor.style.top = y + \"px\";\n\t\t\tthis.cursor.style.left = x + \"px\";\n\t\t}\n\n\t\t//input game coordinates\n\t\tcursorFromGame(point) {\n\t\t\tlet [x, y] = Utils.gameToScreen(point, this.board.tileSize, this.board.spacing).get;\n\t\t\tthis.cursor.style.top = y + \"px\";\n\t\t\tthis.cursor.style.left = x  + \"px\";\n\t\t}\n\t};\n\n\t//the game\n\tconst Game = class Game {\n\t\tconstructor(board, objs) {\n\t\t\t\n\t\t\tthis.logger = new LogboxManager(document.getElementById(\"logbox\"), 10);\n\n\t\t\tthis.time = 0;\n\t\t\t\n\t\t\tthis.board = board;\n\t\t\tthis.player = objs[0];\n\t\t\tthis.objs = [];\n\t\t\tobjs.forEach(obj => this.objs[obj.id] = obj);\n\n\t\t\tthis.logic = new ActionManager(this.board, this.logger);\n\n\t\t\tthis.keyHandler = new KeyHandler();\n\t\t\tdocument.addEventListener(\"keydown\", e => {\n\t\t\t\tif (this.logic.delegateAction(this.player, this.keyHandler.get(e.keyCode))) {\n\t\t\t\t\tthis.update();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tlet miscOtherInfoContainer = document.getElementById(\"info-container-other-misc\");\n\t\t\t\n\t\t\tthis.examineContainer = document.createElement(\"div\");\n\t\t\tthis.examineContainer.style.padding = \"10px\";\n\t\t\t\n\t\t\tmiscOtherInfoContainer.appendChild(this.examineContainer);\n\n\t\t\t//cleaned this up a bit but it's still not very nice\n\t\t\tthis.mouseHandler = new MouseHandler(this.board);\n\t\t\tdocument.addEventListener(\"mousemove\", e => {\n\t\t\t\tlet bounds = this.board.bounds;\n\t\t\t\tlet screenPoint = new Point(e.pageX, e.pageY);\n\t\t\t\t\n\t\t\t\t//mouse is inside game screen\n\t\t\t\tif (screenPoint.in(bounds)) {\n\t\t\t\t\tlet fov = this.logic.getFov(this.player),\n\t\t\t\t\t\tgamePoint = Utils.screenToGame(screenPoint, this.board.tileSize, this.board.spacing);\n\t\t\t\t\t\t\n\t\t\t\t\t//set cursor position\n\t\t\t\t\tthis.mouseHandler.cursorFromScreen(screenPoint);\n\t\t\t\t\t\t\n\t\t\t\t\t//if hovering over a tile that is seen\n\t\t\t\t\tif(fov && fov.has(gamePoint)){\n\t\t\t\t\t\tlet targetTile = this.board.get(gamePoint);\n\t\t\t\t\t\t\n\t\t\t\t\t\t//if tile is not empty\n\t\t\t\t\t\tif (targetTile && targetTile.top) {\n\t\t\t\t\t\t\t//reset all lifebars styles\n\t\t\t\t\t\t\tthis.objs.forEach(obj => {\n\t\t\t\t\t\t\t\tif (obj.lifebar) obj.lifebar.setStyle(\"default\");\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t//set examine text\n\t\t\t\t\t\t\tthis.examineContainer.innerHTML = targetTile.top;\n\t\t\t\t\t\t\t//highlight lifebar\n\t\t\t\t\t\t\tif (targetTile.top instanceof Creature) {\n\t\t\t\t\t\t\t\ttargetTile.top.lifebar.setStyle(\"hilight\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.examineContainer.innerHTML = targetTile;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//tile is not in fov\n\t\t\t\t\t\tthis.examineContainer.innerHTML = \"You can't see that\";\n\t\t\t\t\t}\n\t\t\t\t\t//hovering over a lifebar\n\t\t\t\t} else if (e.target.classList.contains(\"bar-lifebar\")) {\n\t\t\t\t\t//reset all lifebars styles\n\t\t\t\t\tthis.objs.forEach(obj => {\n\t\t\t\t\t\tif (obj.lifebar) obj.lifebar.setStyle(\"default\");\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t//get lifebars owner\n\t\t\t\t\tlet id = e.target.id.match(/[0-9]+$/);\n\t\t\t\t\tlet target = this.objs[Number(id)];\n\n\t\t\t\t\t//set cursor to lifebars owner\n\t\t\t\t\tif (target) {\n\t\t\t\t\t\tthis.mouseHandler.cursorFromGame(target.position);\n\t\t\t\t\t\tthis.examineContainer.innerHTML = target;\n\t\t\t\t\t\ttarget.lifebar.setStyle(\"hilight\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tthis.inventoryManager = new InventoryManager(document.getElementById(\"info-container-inventory\"), this.player.inventory);\n\t\t}\n\n\t\tupdate() {\n\t\t\tlet duration = this.player.update(this.logger);\n\t\t\tlet tickCount = duration / TICK;\n\t\t\t\n\t\t\t//contains the total durations of each objs actions for this turn\n\t\t\tlet objDurations = [];\n\t\t\tfor(let i = 0; i < tickCount; i++){\n\t\t\t\tthis.time += TICK;\n\t\t\t\t\n\t\t\t\tthis.objs.forEach((obj, index) => {\n\t\t\t\t\tif(index === 0){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif(obj.isAlive){\n\t\t\t\t\t\tlet duration = obj.update(this.logger, this.time + (objDurations[obj.id] || 0));\n\t\t\t\t\t\tif(duration > 0){\n\t\t\t\t\t\t\t//if action was excecuted we generate new ones and\n\t\t\t\t\t\t\t//forward the time for this obj\n\t\t\t\t\t\t\tthis.logic.think(obj, this.player);\n\t\t\t\t\t\t\tobjDurations[obj.id] = objDurations[obj.id] ? objDurations[obj.id] + duration : duration;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(!obj.isAlive){\n\t\t\t\t\t\t\tthis.board.remove(obj);\n\t\t\t\t\t\t\tdelete this.objs[obj.id];\n\t\t\t\t\t\t}\n\t\t\t\t\t}else{\n\t\t\t\t\t\tthis.board.remove(obj);\n\t\t\t\t\t\tdelete this.objs[obj.id];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tif(!this.player.isAlive){\n\t\t\t\tthis.board.remove(this.player);\n\t\t\t\tdelete this.player;\n\t\t\t}\n\n\t\t\tlet fov = this.logic.getFov(this.player);\n\t\t\t\n\t\t\tif(fov){\n\t\t\t\tthis.objs.forEach(obj => {\n\t\t\t\t\tif(obj.type === \"Enemy\"){\n\t\t\t\t\t\tif(fov.has(obj.position)){\n\t\t\t\t\t\t\tobj.lifebar.show();\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tobj.lifebar.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tmainCtx.clearRect(0, 0, w, h);\n\t\t\t\tfov.draw();\n\t\t\t\tsecondCtx.drawImage(mainCanvas, 0, 0);\n\t\t\t}\n\n\t\t\tthis.inventoryManager.update();\n\t\t}\n\n\t\tstart() {\n\t\t\tdocument.getElementById(\"button-save\").addEventListener(\"click\", e => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tUtils.saveGame(this);\n\t\t\t});\n\t\t\t\n\t\t\tdocument.getElementById(\"button-delete\").addEventListener(\"click\", e => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tUtils.deleteSave();\n\t\t\t});\n\t\t\t\n\t\t\tthis.logger.log(\"Hello and welcome\", \"hilight\");\n\t\t\tthis.objs.forEach(obj => {\n\t\t\t\tif (obj) {\n\t\t\t\t\tthis.board.insert(obj);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tlet fov = this.logic.getFov(this.player);\n\t\t\t\n\t\t\tthis.objs.forEach(obj => {\n\t\t\t\tthis.logic.think(obj, this.player);\n\t\t\t\tif(obj.type === \"Enemy\"){\n\t\t\t\t\tif(fov.has(obj.position)){\n\t\t\t\t\t\tobj.lifebar.show();\n\t\t\t\t\t}else{\n\t\t\t\t\t\tobj.lifebar.hide();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tfov.draw();\n\t\t\tthis.inventoryManager.update();\n\t\t\t\n\t\t\tdocument.getElementById(\"loader\").remove();\n\t\t}\n\t};\n\n\tvar game = Utils.loadGame() || new Game(\n\t\tnew TileGroup(null, {\n\t\t\torigin: new Point(0, 0),\n\t\t\tbaseColor: \"slategrey\",\n\t\t\ttileSize: 25,\n\t\t\tspacing: 1,\n\t\t\tw: 40,\n\t\t\th: 20\n\t\t}), Utils.DungeonGenerator.makeDungeon()\n\t);\n\t\n\tif (env === \"dev\") {\n\t\tUtils.exportObjs(Utils.exports);\n\t} else if (env === \"prod\") {\n\n\t} else {\n\t\tthrow new TypeError(\"Invalid environment\");\n\t}\n\n\t//force save on unload\n\t/*\n\tglobal.onbeforeunload = () => {\n\t\tsetTimeout(saveGame(instance), 0);\n\t\treturn \"Really save & quit the game?\";\n\t};\n\t*/\n\n\t/*********************************/\n\n\tgame.start();\n\n})(window);"]}