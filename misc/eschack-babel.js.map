{"version":3,"sources":["eschack.js"],"names":[],"mappings":"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","file":"eschack-babel.js","sourcesContent":["(function(global){\n \"use strict\";\n//these contain the logic for actions but they will be used on the actor\r\n//the context shouldnt be changed but the action can be reused\r\n//even on different actors\r\n//maybe these should be stored in a pool somewhere...?\r\nconst Action = class Action {\r\n\tconstructor(context, logger) {\r\n\t\tif(this.constructor === Action){\r\n\t\t\tthrow new TypeError(\"Action is abstract\");\r\n\t\t}\r\n\t\t/*\r\n\t\tif (new.target === Action) {\r\n\t\t\tthrow new TypeError(\"Action is abstract\");\r\n\t\t}\r\n\t\t*/\r\n\t\t//the context or the state that the actor will act upon, eg. the board, a menu etc\r\n\t\tthis.context = context;\r\n\t\tthis.logger = logger;\r\n\t}\r\n\r\n\t//test if action can be done\r\n\ttry (actor) {\r\n\t\tconsole.warn(\"Unimplemented method '\" + arguments.callee + \"' in \" + this.constructor.name);\r\n\t}\r\n\r\n\t//execute action\r\n\tdo(actor) {\r\n\t\tconsole.warn(\"Unimplemented method '\" + arguments.callee + \"' in \" + this.constructor.name);\r\n\t}\r\n};\n//just a xy point\r\nconst Point = class Point {\r\n\tconstructor(x, y) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t}\r\n\r\n\t//set values from array input\r\n\tset(x,y) {\r\n\t\tif(x.constructor === Array){\r\n\t\t\tthis.x = x[0];\r\n\t\t\tthis.y = x[1];\r\n\t\t}else{\r\n\t\t\tthis.x = x;\r\n\t\t\tthis.y = y;\r\n\t\t}\r\n\t}\r\n\r\n\t//get get get get got got got got\r\n\t//return xy as array\r\n\tget get() {\r\n\t\treturn [this.x, this.y];\r\n\t}\r\n\r\n\t//relative move\r\n\tmoveBy(vector) {\r\n\t\tlet [x, y] = vector.get;\r\n\t\tthis.x += x;\r\n\t\tthis.y += y;\r\n\t}\r\n\r\n\t//get manhattan distance vector between two points\r\n\tstatic distance(point1, point2) {\r\n\t\treturn new Vector(\r\n\t\t\tpoint2.x - point1.x,\r\n\t\t\tpoint2.y - point1.y\r\n\t\t);\r\n\t}\r\n\r\n\t//compare two points\r\n\tstatic equal(point1, point2) {\r\n\t\treturn point1.x === point2.x && point1.y === point2.y;\r\n\t}\r\n\t\r\n\t//check if point is inside given bounds\r\n\tin(bounds){\r\n\t\treturn this.x >= bounds.x && this.x <= bounds.x + bounds.w && this.y >= bounds.y && this.y <= bounds.y + bounds.h;\r\n\t}\r\n};\n/* @depends ../core/point.class.js */\r\n//basically any gameobject that takes up a whole tile is a GameObject\r\n//this is the base class so uhhh let's not allow instantiation\r\nconst GameObject = class GameObject {\r\n\tconstructor(position) {\r\n\t\tif(this.constructor === GameObject){\r\n\t\t\tthrow new TypeError(\"GameObject is abstract\");\r\n\t\t}\r\n\t\t/*\r\n\t\tif (new.target === GameObject) {\r\n\t\t\tthrow new TypeError(\"GameObject is abstract\");\r\n\t\t}\r\n\t\t*/\r\n\t\tthis.id = objectCounter;\r\n\t\tobjectCounter += 1;\r\n\t\t\r\n\t\tthis.position = position;\r\n\t\tthis.bgColor = \"magenta\";\r\n\t\tthis.glyph = \"\\u26a0\"; //cool warning sign character (?)\r\n\t\tthis.color = \"black\";\r\n\t\tthis.flavorName = \"OBJ\"; //name mainly used in log messages\r\n\t\tthis.type = this.constructor.name; //used in identifying objects when loading from json\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tconsole.warn(\"Unimplemented method 'update' in \" + this.constructor.name);\r\n\t}\r\n\r\n\tget isAlive() {\r\n\t\treturn this.hasOwnProperty(\"stats\") ? this.stats.HP > 0 : true;\r\n\t}\r\n\r\n\t//recreate class from plain obj\r\n\tstatic from(obj) {\r\n\t\tlet point = null;\r\n\t\tif(obj.position){\r\n\t\t\tpoint = new Point(obj.position.x, obj.position.y);\r\n\t\t}\r\n\t\tlet newObj = new this(point, obj.stats);\r\n\r\n\t\tlet exempt = [\"lifebar\", \"position\", \"inventory\", \"equipment\"];\r\n\r\n\t\tfor (let key in obj) {\r\n\t\t\tif (!exempt.includes(key)) {\r\n\t\t\t\tnewObj[key] = obj[key];\r\n\t\t\t}\r\n\t\t}\r\n\t\tnewObj.inventory = [];\r\n\t\tfor(let key in obj.inventory){\r\n\t\t\tnewObj.inventory[key] = (eval(obj.inventory[key].type)).from(obj.inventory[key]);\r\n\t\t}\r\n\t\tnewObj.equipment = [];\r\n\t\tfor(let key in obj.equipment){\r\n\t\t\tnewObj.equipment[key] = (eval(obj.equipment[key].type)).from(obj.equipment[key]);\r\n\t\t}\r\n\t\t\r\n\t\treturn newObj;\r\n\t}\r\n\r\n\ttoString() {\r\n\t\treturn this.type;\r\n\t}\r\n};\nconst Lifebar = class Lifebar {\r\n\tconstructor(id, name, container, max, value) {\r\n\t\tthis.id = id;\r\n\t\tthis.name = name;\r\n\t\tthis.max = max;\r\n\t\tthis.value = value || max;\r\n\r\n\t\tthis.container = container;\r\n\r\n\t\tlet label = document.createElement(\"label\");\r\n\t\tlabel.setAttribute(\"for\", \"bar-lifebar-\" + this.name + \"-\" + this.id);\r\n\t\tlabel.innerHTML = this.name;\r\n\t\tthis.label = label;\r\n\r\n\t\tlet bar = document.createElement(\"div\");\r\n\t\tbar.className = \"bar bar-lifebar\";\r\n\t\tbar.id = \"bar-lifebar-\" + this.name + \"-\" + this.id;\r\n\t\tthis.bar = bar;\r\n\r\n\t\tthis.set();\r\n\r\n\t\tthis.container.appendChild(label);\r\n\t\tthis.label.appendChild(bar);\r\n\t}\r\n\r\n\tset(value) {\r\n\t\tif (!isNaN(value)) {\r\n\t\t\tthis.value = value;\r\n\t\t}\r\n\t\tthis.bar.setAttribute(\"data-content\", this.value + \"/\" + this.max);\r\n\r\n\t\t//approximate visual size, range [0...100]\r\n\t\t//do we need more precision? is this too much precision?\r\n\t\tlet sizeClass = \"bar-size-\" + Math.max(Math.floor(this.value / this.max * 100), 0);\r\n\t\tif (this.bar.className.match(/size/)) {\r\n\t\t\tthis.bar.className = this.bar.className.replace(/bar-size-[0-9]{1,3}/, sizeClass);\r\n\t\t} else {\r\n\t\t\tthis.bar.classList.add(sizeClass);\r\n\t\t}\r\n\t}\r\n\r\n\tsetStyle(style) {\r\n\t\tlet styles = {\r\n\t\t\t\"hilight\": \"hilighted\",\r\n\t\t\t\"default\": \"default\"\r\n\t\t};\r\n\t\tstyle = styles[style];\r\n\t\tif (style) {\r\n\t\t\t//remove other styles\r\n\t\t\tObject.values(styles).filter(v => v !== style).forEach(f => {\r\n\t\t\t\tthis.bar.classList.remove(f);\r\n\t\t\t\tthis.label.classList.remove(f);\r\n\t\t\t});\r\n\r\n\t\t\tthis.bar.classList.add(style);\r\n\t\t\tthis.label.classList.add(style);\r\n\t\t}\r\n\t}\r\n\r\n\t//remove from dom\r\n\tremove() {\r\n\t\tthis.bar.remove();\r\n\t\tthis.label.remove();\r\n\t}\r\n\r\n\thide() {\r\n\t\tthis.bar.style.display = \"none\";\r\n\t\tthis.label.style.display = \"none\";\r\n\t}\r\n\r\n\tshow() {\r\n\t\tthis.bar.style.display = \"\";\r\n\t\tthis.label.style.display = \"\";\r\n\t}\r\n};\n/* @depends ../ui/lifebar.class.js */\r\nconst MoveBlocking = Base => class extends Base{\r\n\tget isMoveBlocking(){\r\n\t\treturn true;\r\n\t}\r\n};\r\nconst VisionBlocking = Base => class extends Base{\r\n\tget isVisionBlocking(){\r\n\t\treturn true;\r\n\t}\r\n};\r\n\r\nconst Hittable = Base => class extends Base{\r\n\ttakeDamage(damage, logger) {\r\n\t\tthis.stats.HP -= damage;\r\n\t\tif (this.lifebar) this.lifebar.set(this.stats.HP);\r\n\t\tif (this.stats.HP <= 0) {\r\n\t\t\tthis.die(logger);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\tdie(logger) {\r\n\t\tif(logger)logger.log(this.flavorName + \" died\", \"death\");\r\n\t\tif(this.lifebar && this.type !== \"Player\")this.lifebar.remove();\r\n\t}\r\n\t\r\n\tget isHittable(){\r\n\t\treturn true;\r\n\t}\r\n};\n/* @depends gameobject.class.js */\r\nconst Item = class Item extends GameObject{\r\n\tconstructor(position){\r\n\t\tsuper(position);\r\n\t\tthis.canDrop = true;\r\n\t}\r\n\t\r\n\tupdate(){\r\n\t\treturn true;\r\n\t}\r\n};\n/* @depends ../abstract/item.class.js */\r\nconst Weapon = class Weapon extends Item{\r\n\t//todo: basespeed (weight?), special properties (cleave, reach)\r\n\t//stuff\r\n\tconstructor(name, damage, speed) {\r\n\t\tsuper(null);\r\n\t\tthis.slot = \"weapon\";\r\n\t\tthis.damage = damage || 1;\r\n\t\tthis.speed = speed || 10;\r\n\t\tthis.name = name;\r\n\t\t\r\n\t\tthis.glyph = \"(\";\r\n\t\tthis.color = \"red\";\r\n\t\tthis.bgColor = TILE_COLOR;\r\n\t\tthis.flavorName = this.name;\r\n\t}\r\n\t\r\n\ttoString(){\r\n\t\treturn `${this.name} (${this.damage}, ${this.speed})`;\r\n\t}\r\n};\n/* @depends ../abstract/item.class.js */\r\nconst Armor = class Armor extends Item{\r\n\tconstructor(slot, name, defence){\r\n\t\tsuper(null);\r\n\t\tthis.slot = slot;\r\n\t\tthis.name = name;\r\n\t\tthis.defence = defence;\r\n\t\t\r\n\t\tthis.glyph = \"[\";\r\n\t\tthis.color = \"cyan\";\r\n\t\tthis.bgColor = TILE_COLOR;\r\n\t\tthis.flavorName = this.name;\r\n\t}\r\n\t\r\n\ttoString(){\r\n\t\treturn `${this.name} (${this.defence})`;\r\n\t}\r\n};\n/* \r\n@depends ../abstract/gameobject.class.js\r\n@depends ../misc/mixins.js\r\n@depends ../objs/weapon.class.js\r\n@depends ../objs/armor.class.js\r\n */\r\n//any living dead undead whatever creature\r\nconst Creature = class Creature extends Hittable(MoveBlocking(GameObject)) {\r\n\tconstructor(position, stats, weapon) {\r\n\t\tsuper(position);\r\n\t\t//actions actually contains arrays of actions\r\n\t\tthis.actions = [];\r\n\r\n\t\tlet self = this;\r\n\t\tthis.stats = stats || {\r\n\t\t\t\"maxHP\": 3,\r\n\t\t\t\"HP\": 3,\r\n\t\t\t\"viewDistance\": 5,\r\n\t\t\t\"moveSpeed\": 10,\r\n\t\t\t\"inventorySize\": 5,\r\n\t\t\tget AC(){\r\n\t\t\t\t//add up the defence values of all equipped armor\r\n\t\t\t\treturn Object.keys(self.equipment)\r\n\t\t\t\t\t.filter(k => self.equipment[k] && self.equipment[k].constructor === Armor)\r\n\t\t\t\t\t\t.reduce((p, c) => self.equipment[c].defence + p, 0);\r\n\t\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tthis.inventory = [];\r\n\t\tthis.equipment = {\r\n\t\t\t\"weapon\": weapon || new Weapon(\"Fists\"),\r\n\t\t\t\"head\": null,\r\n\t\t\t\"body\": null,\r\n\t\t\t\"hands\": null,\r\n\t\t\t\"legs\": null,\r\n\t\t\t\"feet\": null\r\n\t\t};\r\n\r\n\t\tthis.flavorName = \"creature\";\r\n\t\tthis.flavor = \"It is mundane.\"; //flavor text used in examine\r\n\t\t\r\n\t\tthis.xp = 1;\r\n\t}\r\n\r\n\t//oh boy\r\n\tupdate(logger, time = 0) {\r\n\r\n\t\tlet updateCount = 0,\r\n\t\t\telapsedTime = 0;\r\n\t\r\n\t\t//go through all the possible actions given by actionmanager and\r\n\t\t//test their logic in the gameobjects context\r\n\t\t//they should already be in prioritized order so\r\n\t\t//we just use the first one that succeeds\r\n\t\tthis.actions.forEach(proposals => {\r\n\t\t\t//actually they contain functions that create the action instances so yeah\r\n\t\t\ttry {\r\n\t\t\t\tlet chosen;\r\n\t\t\t\t\r\n\t\t\t\tproposals.some(p => {\r\n\t\t\t\t\tlet action = p();\r\n\t\t\t\t\tif(action.try(this, time)){\r\n\t\t\t\t\t\tchosen = action;\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\telapsedTime += chosen.do(this);\r\n\t\t\t\tupdateCount++;\r\n\t\t\t} catch (err) {\r\n\t\t\t\t//console.warn(\"None of the proposed actions were suitable for \" + this.constructor.name);\r\n\t\t\t\t//console.log(err);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tfor(let i = 0; i < updateCount; i++){\r\n\t\t\tthis.actions.shift();\r\n\t\t}\r\n\r\n\t\treturn elapsedTime;\r\n\t}\r\n\r\n\ttoString() {\r\n\t\treturn `${this.type}<br>${this.stats.HP} HP<br>${this.flavor}<br>${this.equipment.weapon.damage} ATT`;\r\n\t}\r\n\t\r\n\tget items(){\r\n\t\tlet items = this.inventory.concat(Object.values(this.equipment)).filter(v => v);\r\n\t\treturn items;\r\n\t}\r\n};\n/* @depends gameobject.class.js */\r\nconst DungeonFeature = class DungeonFeature extends GameObject{\r\n\tconstructor(position){\r\n\t\tsuper(position);\r\n\t}\r\n};\n/* @depends creature.class.js */\r\n//maybe this should be abstract\r\nconst Enemy = class Enemy extends Creature {\r\n\tconstructor(position, stats, weapon) {\r\n\t\tsuper(position, stats, weapon);\r\n\t\tthis.actions = [];\r\n\t\tthis.bgColor = \"hsl(30, 30%, 45%)\";\r\n\t\tthis.glyph = \"E\";\r\n\t\tthis.color = \"white\";\r\n\r\n\t\tthis.stats.maxHP = 3;\r\n\t\tthis.stats.HP = 3;\r\n\t\tthis.stats.viewDistance = 7;\r\n\t\tthis.stats.moveSpeed = 9;\r\n\r\n\t\tthis.stats = stats || this.stats;\r\n\r\n\t\tthis.flavorName = \"the enemy\";\r\n\t\tthis.flavor = \"It has a fearsome visage.\";\r\n\t}\r\n\r\n\ttoString() {\r\n\t\treturn this.type + \"<br>\" + this.stats.HP + \" HP<br>\" + this.flavor + \"<br>\" + this.equipment.weapon.damage + \" ATT<br>\" + (this.noticed ? \"It has noticed you.\" : \"It has not noticed you.\");\r\n\t}\r\n\t\r\n\tcreateLifebar(){\r\n\t\tthis.lifebar = new Lifebar(this.id, this.type, document.getElementById(\"info-container-other-life\"), this.stats.maxHP, this.stats.HP);\r\n\t}\r\n};\nconst Vector = class Vector {\r\n\tconstructor(u, v) {\r\n\t\t//if no arguments, use random values in [-1, 0, 1]\r\n\t\tthis.u = isNaN(u) ? Math.sign(Math.random() * 10 - 5) : u;\r\n\t\tthis.v = isNaN(v) ? Math.sign(Math.random() * 10 - 5) : v;\r\n\t}\r\n\r\n\tset(arr) {\r\n\t\tthis.u = arr[0];\r\n\t\tthis.v = arr[1];\r\n\t}\r\n\r\n\tget get() {\r\n\t\treturn [this.u, this.v];\r\n\t}\r\n\r\n\t//basically this just sets the larger\r\n\t//absolute value to 1 and the smaller to 0\r\n\treduce() {\r\n\t\tlet vals = this.get;\r\n\t\tlet absmax = Math.max.apply(null, vals.map(Math.abs));\r\n\t\tthis.set(vals.map(v => Math.round(v / absmax)));\r\n\t}\r\n};\n/* @depends ../core/vector.class.js */\r\n//handle key related stuff and i guess also some action mapping lol\r\nconst KeyHandler = class KeyHandler {\r\n\tconstructor() {\r\n\t\tthis.use(\"default\");\r\n\t}\r\n\t\r\n\tuse(map = \"default\"){\r\n\t\tif(map ===\"default\"){\r\n\t\t\tthis.using = \"default\";\r\n\t\t\t\r\n\t\t\tthis.keyCases = {\r\n\t\t\t\t//numpad\r\n\t\t\t\t104: \"n\",\r\n\t\t\t\t100: \"w\",\r\n\t\t\t\t98: \"s\",\r\n\t\t\t\t102: \"e\",\r\n\t\t\t\t105: \"ne\",\r\n\t\t\t\t99: \"se\",\r\n\t\t\t\t97: \"sw\",\r\n\t\t\t\t103: \"nw\",\r\n\t\t\t\t\r\n\t\t\t\t//vi keys\r\n\t\t\t\t75: \"n\", //k\r\n\t\t\t\t76: \"e\", //l\r\n\t\t\t\t74: \"s\", //j\r\n\t\t\t\t72: \"w\", //h\r\n\t\t\t\t89: \"nw\", //y\r\n\t\t\t\t85: \"ne\", //u\r\n\t\t\t\t66: \"sw\", //b\r\n\t\t\t\t78: \"se\", //n\r\n\r\n\t\t\t\t101: \"c\", //num5\r\n\t\t\t\t\r\n\t\t\t\t71: \"pickup\", //g\r\n\t\t\t\t\r\n\t\t\t\t68: {use: \"inventorydialog\", act: \"drop\"}, //d\r\n\t\t\t\t87: {use: \"inventorydialog\", act: \"equip\"}, //w\r\n\t\t\t\t\r\n\t\t\t\t60: \"up\", //<\r\n\t\t\t\t62: \"down\" //>\r\n\t\t\t};\r\n\r\n\t\t\tthis.actionMap = {\r\n\t\t\t\t\"n\": () => new Vector(0, -1),\r\n\t\t\t\t\"w\": () => new Vector(-1, 0),\r\n\t\t\t\t\"s\": () => new Vector(0, 1),\r\n\t\t\t\t\"e\": () => new Vector(1, 0),\r\n\t\t\t\t\"ne\": () => new Vector(1, -1),\r\n\t\t\t\t\"se\": () => new Vector(1, 1),\r\n\t\t\t\t\"sw\": () => new Vector(-1, 1),\r\n\t\t\t\t\"nw\": () => new Vector(-1, -1),\r\n\t\t\t\t\"c\": null,\r\n\t\t\t\t\"pickup\": \"pickup\",\r\n\t\t\t\t\"up\": \"stair\",\r\n\t\t\t\t\"down\": \"stair\"\r\n\t\t\t};\r\n\t\t\t\r\n\t\t}else if(map === \"inventorydialog\"){\r\n\t\t\tthis.using = \"inventorydialog\";\r\n\t\t\tthis.keyCases = \"abcdefghijklmnopqrstuvwxyz\".split(\"\").reduce((p, c) => (p[c.toUpperCase().charCodeAt(0)] = c, p), {});\r\n\t\t}\r\n\t}\r\n\r\n\t//input is a key or a keycode\r\n\t//returns action instruction\r\n\tget(key) {\r\n\t\tif(typeof this.keyCases[key] === \"object\"){\r\n\t\t\tthis.act = this.keyCases[key].act;\r\n\t\t\tthis.use(this.keyCases[key].use);\r\n\t\t\treturn this.act;\r\n\t\t}else if(this.using === \"inventorydialog\"){\r\n\t\t\tlet val = this.keyCases[key];\r\n\t\t\t//return default\r\n\t\t\tthis.use();\r\n\t\t\treturn this.act+\":\"+val;\r\n\t\t}\r\n\t\tthis.act = undefined;\r\n\t\treturn this.actionMap[this.keyCases[key]];\r\n\t}\r\n};\n/* @depends ../abstract/dungeonfeature.class.js */\r\nconst Stair = class Stair extends GameObject{\r\n\tconstructor(position, direction){\r\n\t\tsuper(position);\r\n\t\tthis.direction = direction;\r\n\t\tthis.bgColor = \"hsl(0,0%,35%)\";\r\n\t\t\r\n\t\tif(this.direction === \"up\"){\r\n\t\t\tthis.glyph = \"<\";\r\n\t\t}else if(this.direction === \"down\"){\r\n\t\t\tthis.glyph = \">\";\r\n\t\t}\r\n\t\tthis.color = \"hsl(0,0%,75%)\";\r\n\t\tthis.flavorName = this.direction+\"stair\";\r\n\t}\r\n\t\r\n\tupdate(){\r\n\t\treturn 0;\r\n\t}\r\n\t\r\n\ttoString(){\r\n\t\treturn \"A staircase going \"+this.direction;\r\n\t}\r\n};\n/* @depends ../abstract/dungeonfeature.class.js */\r\n//todo: create base class Inanimate or something\r\nconst Wall = class Wall extends VisionBlocking(MoveBlocking(DungeonFeature)) {\r\n\tconstructor(position) {\r\n\t\tsuper(position);\r\n\t\tthis.bgColor = \"hsl(0,0%,15%)\";\r\n\t\tthis.glyph = \"\\u2589\"; //some block character\r\n\t\tthis.color = \"hsl(0,0%,25%)\";\r\n\t\tthis.flavorName = \"wall\";\r\n\t}\r\n\r\n\tupdate() {\r\n\t\treturn 0;\r\n\t}\r\n};\n/* @depends ../abstract/enemy.class.js */\r\nconst Honeybadger = class Honeybadger extends Enemy {\r\n\tconstructor(position){\r\n\t\tsuper(position, null, new Weapon(\"Claws\", 4, 11));\r\n\t\tthis.bgColor = \"hsl(25, 5%, 10%)\";\r\n\t\tthis.glyph = \"B\";\r\n\t\tthis.color = \"hsl(5, 5%, 90%)\";\r\n\t\t\r\n\t\tthis.equipment.weapon.canDrop = false;\r\n\t\t\r\n\t\tthis.stats.maxHP = 10;\r\n\t\tthis.stats.HP = 10;\r\n\t\tthis.stats.viewDistance = 7;\r\n\t\tthis.stats.moveSpeed = 10;\r\n\t\tthis.flavorName = \"the honeybadger\";\r\n\t\tthis.flavor = \"Notorious for their ferocity.\";\r\n\t\tthis.createLifebar();\r\n\t}\r\n};\n/* @depends ../abstract/enemy.class.js */\r\nconst Jackalope = class Jackalope extends Enemy {\r\n\tconstructor(position){\r\n\t\tsuper(position, null, new Weapon(\"Antlers\", 2, 5));\r\n\t\tthis.bgColor = \"hsl(35, 25%, 65%)\";\r\n\t\tthis.glyph = \"J\";\r\n\t\tthis.color = \"hsl(35, 35%, 5%)\";\r\n\t\t\r\n\t\tthis.equipment.weapon.canDrop = false;\r\n\t\t\r\n\t\tthis.stats.maxHP = 6;\r\n\t\tthis.stats.HP = 6;\r\n\t\tthis.stats.viewDistance = 7;\r\n\t\tthis.stats.moveSpeed = 8;\r\n\t\tthis.flavorName = \"the jackalope\";\r\n\t\tthis.flavor = \"A large agressive rabbit with antlers on its head.\";\r\n\t\tthis.createLifebar();\r\n\t}\r\n};\n/* @depends ../abstract/enemy.class.js */\r\nconst Redcap = class Redcap extends Enemy {\r\n\tconstructor(position){\r\n\t\tsuper(position, null, null);\r\n\t\tthis.bgColor = \"hsl(66, 10%, 70%)\";\r\n\t\tthis.glyph = \"^\";\r\n\t\tthis.color = \"hsl(0, 80%, 60%)\";\r\n\t\t\r\n\t\tthis.stats.maxHP = 10;\r\n\t\tthis.stats.HP = 10;\r\n\t\tthis.stats.viewDistance = 7;\r\n\t\tthis.stats.moveSpeed = 10;\r\n\t\tthis.flavorName = \"the redcap\";\r\n\t\tthis.flavor = \"A malevolent murderous dwarf-like creature.\";\r\n\t\tthis.createLifebar();\r\n\t\t\r\n\t\tthis.canWield = true;\r\n\t\tthis.canWear = true;\r\n\t}\r\n};\n/* \r\n@depends ../objs/stair.class.js\r\n@depends ../objs/wall.class.js\r\n@depends monsters/honeybadger.class.js\r\n@depends jackalope.class.js\r\n@depends redcap.class.js\r\n */\r\nconst Utils = class Utils {\r\n\t\r\n\tstatic get defaults(){\r\n\t\treturn {\r\n\t\t\tweapon: () => new Weapon(\"Fists\")\r\n\t\t};\r\n\t}\r\n\t\r\n\tstatic get exports(){\r\n\t\treturn {\r\n\t\t\t\"instance\": game,\r\n\t\t\t\"Creature\": Creature,\r\n\t\t\t\"Player\": Player,\r\n\t\t\t\"GameObject\": GameObject,\r\n\t\t\t\"Point\": Point,\r\n\t\t\t\"Vector\": Vector,\r\n\t\t\t\"ActionManager\": ActionManager,\r\n\t\t\t\"TileGroup\": TileGroup,\r\n\t\t\t\"Utils\": Utils,\r\n\t\t\t\"Tile\": Tile,\r\n\t\t\t\"Wall\": Wall\r\n\t\t};\r\n\t}\r\n\t\r\n\tstatic get alphabetMap(){\r\n\t\treturn [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\"];\r\n\t}\r\n\r\n\tstatic rotate(arr, angle) {\r\n\t\tif (angle === 90) {\r\n\t\t\treturn Utils.transpose(arr.reverse());\r\n\t\t} else if (angle === -90) {\r\n\t\t\treturn Utils.transpose(arr).reverse();\r\n\t\t} else if (angle === 180 || angle === -180) {\r\n\t\t\treturn Utils.transpose(Utils.transpose(arr).reverse()).reverse();\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Invalid angle\");\r\n\t\t\treturn arr;\r\n\t\t}\r\n\t}\r\n\r\n\t//http://stackoverflow.com/a/4492703\r\n\tstatic transpose(arr) {\r\n\t\tvar w = arr.length ? arr.length : 0,\r\n\t\t\th = arr[0] instanceof Array ? arr[0].length : 0;\r\n\r\n\t\tif (h === 0 || w === 0) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t\tvar i, j, t = [];\r\n\t\tfor (i = 0; i < h; i++) {\r\n\t\t\tt[i] = [];\r\n\t\t\tfor (j = 0; j < w; j++) {\r\n\t\t\t\tt[i][j] = arr[j][i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn t;\r\n\t}\r\n\r\n\t//algorithm taken from here\r\n\t//http://www.roguebasin.com/index.php?title=Isaac_s_fast_beamcasting_LOS\r\n\t//and modified\r\n\tstatic beamcast(matrix) {\r\n\t\tlet visible = [];\r\n\t\tfor (let i = 0; i < matrix.length; i++) {\r\n\t\t\tvisible[i] = Array.from(Array(matrix.length));\r\n\t\t}\r\n\r\n\t\t//0,0 will always be visible\r\n\t\tvisible[0][0] = matrix[0][0];\r\n\r\n\t\t//check orthogonals\r\n\t\tlet ox = 0;\r\n\t\twhile (matrix[ox] && matrix[ox][0]) {\r\n\t\t\tvisible[ox][0] = matrix[ox][0];\r\n\t\t\tif (matrix[ox][0].top && matrix[ox][0].top.isVisionBlocking) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tox++;\r\n\t\t}\r\n\t\tlet oy = 0;\r\n\t\twhile (matrix[0] && matrix[0][oy]) {\r\n\t\t\tvisible[0][oy] = matrix[0][oy];\r\n\t\t\tif (matrix[0][oy].top && matrix[0][oy].top.isVisionBlocking) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\toy++;\r\n\t\t}\r\n\r\n\t\t//beams\r\n\t\tfor (let slope = 1, slopeCount = 31; slope <= slopeCount; slope++) {\r\n\t\t\tlet v = slope,\r\n\t\t\t\tmin = 0,\r\n\t\t\t\tmax = slopeCount;\r\n\t\t\tfor (let u = 0; min <= max; u++) {\r\n\t\t\t\tlet y = v >> 5,\r\n\t\t\t\t\tx = u - y,\r\n\t\t\t\t\tcor = slopeCount + 1 - (v & slopeCount),\r\n\t\t\t\t\tneedBreak = false;\r\n\r\n\t\t\t\tif (min < cor) {\r\n\t\t\t\t\tif (matrix[x] && matrix[x][y]) {\r\n\t\t\t\t\t\tvisible[x][y] = matrix[x][y];\r\n\t\t\t\t\t\tif (matrix[x][y].top && matrix[x][y].top.isVisionBlocking) {\r\n\t\t\t\t\t\t\tmin = cor;\r\n\t\t\t\t\t\t\tneedBreak = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmin = cor;\r\n\t\t\t\t\t\tneedBreak = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (max < cor) {\r\n\t\t\t\t\tif (matrix[x] && matrix[x][y]) {\r\n\t\t\t\t\t\tvisible[x][y] = matrix[x][y];\r\n\t\t\t\t\t\tif (matrix[x][y].top && matrix[x][y].top.isVisionBlocking) {\r\n\t\t\t\t\t\t\tmax = cor;\r\n\t\t\t\t\t\t\tneedBreak = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmax = cor;\r\n\t\t\t\t\t\tneedBreak = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tv += slope;\r\n\t\t\t\tif (needBreak) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn visible;\r\n\t}\r\n\r\n\tstatic mergeQuarters(quarters) {\r\n\t\t//quarters.nw + quarters.ne\r\n\t\t//            +\r\n\t\t//quarters.sw + quarters.se\r\n\r\n\t\tlet upper = quarters.nw.map((row, k) => {\r\n\t\t\t//pop last column of left because it is identical to the first column of right\r\n\t\t\trow.pop();\r\n\r\n\t\t\t//merge rows of left and right\r\n\t\t\treturn row.concat(quarters.ne[k]);\r\n\t\t});\r\n\r\n\t\tlet lower = quarters.sw.map((row, k) => {\r\n\t\t\trow.pop();\r\n\t\t\treturn row.concat(quarters.se[k]);\r\n\t\t});\r\n\r\n\t\t//pop last row of upper because it is identical to the first row of lower\r\n\t\tupper.pop();\r\n\r\n\t\t//merge upper and lower\r\n\t\treturn upper.concat(lower);\r\n\t}\r\n\t\r\n\tstatic saveGame(instance){\r\n\t\tlet save = {};\r\n\t\t//all we need is the objs\r\n\t\t//in Game.start they will get inserted\r\n\t\tsave.objs = instance.objs;\r\n\t\t//remove fov because of circular reference\r\n\t\tsave.objs.forEach(obj => delete obj.fov);\r\n\r\n\t\tlocalStorage.setItem(saveName, LZString.compress(JSON.stringify(save)));\r\n\t\tconsole.log(\"Game saved\");\r\n\t}\r\n\t\r\n\tstatic loadGame() {\r\n\t\tlet save = JSON.parse(LZString.decompress(localStorage.getItem(saveName)) || null);\r\n\r\n\t\tif (save) {\r\n\t\t\tlet objMap = {\r\n\t\t\t\t\"Wall\": Wall,\r\n\t\t\t\t\"Creature\": Creature,\r\n\t\t\t\t\"Enemy\": Enemy,\r\n\t\t\t\t\"Player\": Player,\r\n\t\t\t\t\"Item\": Item,\r\n\t\t\t\t\"Weapon\": Weapon\r\n\t\t\t};\r\n\r\n\t\t\tlet objs = [];\r\n\t\t\tsave.objs.forEach(obj => {\r\n\t\t\t\tif (obj) {\r\n\t\t\t\t\tif (objMap[obj.type]) {\r\n\t\t\t\t\t\tobjs[obj.id] = objMap[obj.type].from(obj);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tconsole.log(\"Savedata loaded\");\r\n\t\t\treturn objs;\r\n\t\t} else {\r\n\t\t\tconsole.log(\"No existing savedata found\");\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\t\r\n\tstatic deleteSave() {\r\n\t\tlocalStorage.removeItem(saveName);\r\n\t\tconsole.log(\"Savedata deleted\");\r\n\t};\r\n\t\r\n\t//convert screen coordinates to game coordinates\r\n\tstatic screenToGame(point, tileSize, spacing){\r\n\t\treturn new Point(Math.floor(point.x / (tileSize + spacing)), Math.floor(point.y / (tileSize + spacing)));\r\n\t}\r\n\t\r\n\t//convert game coordinates to screen coordinates\r\n\tstatic gameToScreen(point, tileSize, spacing){\r\n\t\treturn new Point(point.x * (tileSize + spacing), point.y * (tileSize + spacing));\r\n\t}\r\n\t\r\n\t//convert screen coordinates to conform to tiles\r\n\tstatic screenToTiles(point, tileSize, spacing){\r\n\t\treturn Utils.gameToScreen(Utils.screenToGame(point, tileSize, spacing), tileSize, spacing);\r\n\t}\r\n\r\n\tstatic exportObjs(exports) {\r\n\t\tfor (let key in exports) {\r\n\t\t\tglobal[key] = exports[key];\r\n\t\t}\r\n\t}\r\n\t\r\n\tstatic generateRandomWeapon(){\r\n\t\tlet materials = [\"Bronze\",\"Iron\",\"Steel\"],\r\n\t\t\ttypes = [\"Dagger\",\"Sword\",\"Axe\",\"Pikestaff\"];\r\n\t\t\r\n\t\tlet name = materials[Math.round(Math.random() * (materials.length - 1))] +\r\n\t\t\t\t\" \" + types[Math.round(Math.random() * (types.length - 1))];\r\n\t\t\r\n\t\treturn new Weapon(name, Math.round(Math.random() * 5 + 1), Math.round(Math.random() * 6 + 4));\r\n\t}\r\n\t\r\n\t//use this to generate maps\r\n\t//(actually it generates array of objs which then get inserted by Game)\r\n\tstatic get DungeonGenerator(){\r\n\t\treturn class{\r\n\t\t\tstatic makeRoom(options){\r\n\t\t\t\tlet room = {};\r\n\t\t\t\t\r\n\t\t\t\troom.w = ~~(Math.random() * (options.rooms.size.max.w - options.rooms.size.min.w) + options.rooms.size.min.w);\r\n\t\t\t\troom.h = ~~(Math.random() * (options.rooms.size.max.h - options.rooms.size.min.h) + options.rooms.size.min.h);\r\n\t\t\t\troom.x = ~~(Math.random() * (options.size.w - room.w));\r\n\t\t\t\troom.y = ~~(Math.random() * (options.size.h - room.h));\r\n\t\t\t\t\r\n\t\t\t\treturn room;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tstatic makePoint(options){\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx: ~~(Math.random() * options.size.w),\r\n\t\t\t\t\ty: ~~(Math.random() * options.size.h)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tstatic makePaths(rooms, midPoints, options){\r\n\t\t\t\tlet paths = [];\r\n\t\t\t\t\r\n\t\t\t\t//connect rooms to midpoints\r\n\t\t\t\tfor(let i = 0; i < options.paths.count; i++){\r\n\t\t\t\t\tlet path = {},\r\n\t\t\t\t\t\tdest = midPoints[i % options.paths.count % options.midPoints.count];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tpath.x1 = rooms[i].x + ~~(Math.random() * rooms[i].w);\r\n\t\t\t\t\tpath.y1 = rooms[i].y + ~~(Math.random() * rooms[i].h);\r\n\r\n\t\t\t\t\tpath.x2 = dest.x;\r\n\t\t\t\t\tpath.y2 = rooms[i].y + ~~(Math.random() * rooms[i].h);\r\n\t\t\t\t\t\r\n\t\t\t\t\tpath.x3 = dest.x;\r\n\t\t\t\t\tpath.y3 = dest.y;\r\n\r\n\t\t\t\t\tpaths.push(path);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t//connect midpoints together\r\n\t\t\t\tfor (let i = 1; i < options.midPoints.count; i++) {\r\n\t\t\t\t\tlet path = {};\r\n\r\n\t\t\t\t\tpath.x1 = midPoints[i - 1].x;\r\n\t\t\t\t\tpath.y1 = midPoints[i - 1].y;\r\n\t\t\t\t\t\r\n\t\t\t\t\tpath.x2 = midPoints[i].x;\r\n\t\t\t\t\tpath.y2 = midPoints[i - 1].y;\r\n\r\n\t\t\t\t\tpath.x3 = midPoints[i].x;\r\n\t\t\t\t\tpath.y3 = midPoints[i].y;\r\n\r\n\t\t\t\t\tpaths.push(path);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn paths;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//try to spawn some enemies within room\r\n\t\t\tstatic insertEnemies(room, options){\r\n\t\t\t\tlet enemyList = [Jackalope, Honeybadger, Redcap];\r\n\t\t\t\tlet enemies = [];\r\n\t\t\t\tfor(let x = room.x + room.w; x > room.x; x--){\r\n\t\t\t\t\tfor(let y = room.y + room.h; y > room.y; y--){\r\n\t\t\t\t\t\tif(Math.random() < options.enemies.spawnChance){\r\n\t\t\t\t\t\t\tlet enemy = enemyList[Math.round(Math.random()*(enemyList.length-1))];\r\n\t\t\t\t\t\t\tenemy = new enemy(new Point(x, y));\r\n\t\t\t\t\t\t\tenemy = this.generateEquipment(enemy);\r\n\t\t\t\t\t\t\tenemies.push(enemy);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn enemies;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tstatic generateEquipment(enemy){\r\n\t\t\t\tif(enemy.canWield){\r\n\t\t\t\t\tenemy.equipment.weapon = Utils.generateRandomWeapon();\r\n\t\t\t\t}\r\n\t\t\t\tif(enemy.canWear){\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\treturn enemy;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//main method\r\n\t\t\tstatic makeLevel(player, options){\r\n\t\t\t\toptions = options || this.defaultOptions;\r\n\t\t\t\tlet matrix = [],\r\n\t\t\t\t\tobjs = [],\r\n\t\t\t\t\trooms = Array(options.rooms.count).fill(),\r\n\t\t\t\t\tmidPoints = Array(options.midPoints.count).fill();\r\n\t\t\t\t\t\r\n\t\t\t\t\t//get rooms\r\n\t\t\t\t\tfor(let i in rooms){\r\n\t\t\t\t\t\trooms[i] = this.makeRoom(options);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t//set player to first room\r\n\t\t\t\t\tplayer.position.set(rooms[0].x+1, rooms[0].y+1);\r\n\t\t\t\t\tobjs.push(player);\r\n\r\n\t\t\t\t\tif(options.stairs.up){\r\n\t\t\t\t\t\t//put an upstairs on player\r\n\t\t\t\t\t\tobjs.push(new Stair(new Point(rooms[0].x+1, rooms[0].y+1), \"up\"));\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(options.stairs.down){\r\n\t\t\t\t\t\t//put a downstairs in \"last\" room\r\n\t\t\t\t\t\tobjs.push(new Stair(new Point(rooms[options.rooms.count-1].x+1, rooms[options.rooms.count-1].y+1), \"down\"));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//get midpoints\r\n\t\t\t\t\tfor(let i in midPoints){\r\n\t\t\t\t\t\tmidPoints[i] = this.makePoint(options);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t//get paths\r\n\t\t\t\t\tlet paths = this.makePaths(rooms, midPoints, options);\r\n\t\t\t\t\t\r\n\t\t\t\t\t//fill matrix with walls\r\n\t\t\t\t\tfor (let y = 0; y < options.size.h; y++) {\r\n\t\t\t\t\t\tmatrix[y] = [];\r\n\t\t\t\t\t\tfor (let x = 0; x < options.size.w; x++) {\r\n\t\t\t\t\t\t\tlet tile = new Tile(new Point(x, y));\r\n\t\t\t\t\t\t\ttile.add(new Wall(new Point(x, y)));\r\n\t\t\t\t\t\t\tmatrix[y][x] = tile;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t//carve out rooms\r\n\t\t\t\t\t//and try put some enemies in them\r\n\t\t\t\t\trooms.forEach(room => {\r\n\t\t\t\t\t\tfor(let x = room.x + room.w; x > room.x; x--){\r\n\t\t\t\t\t\t\tfor(let y = room.y + room.h; y > room.y; y--){\r\n\t\t\t\t\t\t\t\tmatrix[y][x].empty();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tobjs = objs.concat(this.insertEnemies(room, options));\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\t//carve out paths\r\n\t\t\t\t\tpaths.forEach(path => {\r\n\t\t\t\t\t\tfor(let i0 = Math.min(path.x1, path.x2), i1 = Math.max(path.x1, path.x2); i0 < i1; i0++){\r\n\t\t\t\t\t\t\tmatrix[path.y1][i0].empty();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor(let i0 = Math.min(path.y2, path.y3), i1 = Math.max(path.y2, path.y3); i0 < i1; i0++){\r\n\t\t\t\t\t\t\tmatrix[i0][path.x2].empty();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\t//get objs\r\n\t\t\t\t\tfor (let y = 0; y < options.size.h; y++) {\r\n\t\t\t\t\t\tfor (let x = 0; x < options.size.w; x++) {\r\n\t\t\t\t\t\t\tif(!matrix[y][x].isEmpty){\r\n\t\t\t\t\t\t\t\tobjs.push(matrix[y][x].top);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\treturn {rooms, paths, objs};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tstatic get defaultOptions(){\r\n\t\t\t\treturn {\r\n\t\t\t\t\tstairs: {\r\n\t\t\t\t\t\tup: false,\r\n\t\t\t\t\t\tdown: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsize: {\r\n\t\t\t\t\t\tw: 40,\r\n\t\t\t\t\t\th: 20\r\n\t\t\t\t\t},\r\n\t\t\t\t\trooms: {\r\n\t\t\t\t\t\tcount: 8,\r\n\t\t\t\t\t\tsize: {\r\n\t\t\t\t\t\t\tmax: {\r\n\t\t\t\t\t\t\t\tw: 8,\r\n\t\t\t\t\t\t\t\th: 8\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tmin: {\r\n\t\t\t\t\t\t\t\tw: 3,\r\n\t\t\t\t\t\t\t\th: 3\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmidPoints: {\r\n\t\t\t\t\t\tcount: 2\r\n\t\t\t\t\t},\r\n\t\t\t\t\tpaths: {\r\n\t\t\t\t\t\tcount: 8\r\n\t\t\t\t\t},\r\n\t\t\t\t\tenemies: {\r\n\t\t\t\t\t\tspawnChance: 0.02\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\t\r\n\tstatic initUIButtons(instance){\r\n\t\tdocument.getElementById(\"button-save\").addEventListener(\"click\", e => {\r\n\t\t\te.stopPropagation();\r\n\t\t\tthis.saveGame(instance);\r\n\t\t});\r\n\t\t\r\n\t\tdocument.getElementById(\"button-delete\").addEventListener(\"click\", e => {\r\n\t\t\te.stopPropagation();\r\n\t\t\tthis.deleteSave();\r\n\t\t});\r\n\t}\r\n};\n/* @depends ../misc/utils.class.js */\r\n//handle mouse stuff and examine cursor\r\nconst MouseHandler = class MouseHandler {\r\n\tconstructor(board) {\r\n\t\tthis.board = board;\r\n\t\tlet cursor = document.createElement(\"div\");\r\n\t\tcursor.id = \"cursor\";\r\n\t\tcursor.style.width = this.board.tileSize + \"px\";\r\n\t\tcursor.style.height = this.board.tileSize + \"px\";\r\n\r\n\t\tthis.cursor = cursor;\r\n\t\tdocument.body.appendChild(this.cursor);\r\n\t}\r\n\r\n\t//set cursor position\r\n\t//input screen coordinates\r\n\tcursorFromScreen(point) {\r\n\t\tlet [x, y] = Utils.screenToTiles(point, this.board.tileSize, this.board.spacing).get;\r\n\t\tthis.cursor.style.top = y + \"px\";\r\n\t\tthis.cursor.style.left = x + \"px\";\r\n\t}\r\n\r\n\t//input game coordinates\r\n\tcursorFromGame(point) {\r\n\t\tlet [x, y] = Utils.gameToScreen(point, this.board.tileSize, this.board.spacing).get;\r\n\t\tthis.cursor.style.top = y + \"px\";\r\n\t\tthis.cursor.style.left = x  + \"px\";\r\n\t}\r\n};\n//Object.values polyfill\r\nif (!Object.values) {\r\n\tObject.values = obj => Object.keys(obj).map(key => obj[key]);\r\n}\r\n\r\n//should these be scopewide?\r\nconst env = \"prod\",\r\n\tTICK = 1,\r\n\tsaveName = \"eschack_save\",\r\n\tmainCanvas = document.getElementById(\"canvas-main\"),\r\n\tsecondCanvas = document.getElementById(\"canvas-second\"),\r\n\tw = 1040,\r\n\th = 520,\r\n\tTILE_COLOR = \"hsla(244,3%,55%,1)\";\r\nmainCanvas.width = secondCanvas.width = w;\r\nmainCanvas.height = secondCanvas.height = h;\r\nconst mainCtx = mainCanvas.getContext(\"2d\"),\r\n\tsecondCtx = secondCanvas.getContext(\"2d\");\r\nmainCtx.font = \"20px Consolas\";\r\nmainCtx.textAlign = \"center\";\r\n\r\nlet objectCounter = 0;\nconst EquipmentManager = class EquipmentManager{\r\n\tconstructor(equipmentBox, equipment){\r\n\t\tthis.wrapper = equipmentBox;\r\n\t\tthis.equipment = equipment;\r\n\t\tlet container = document.createElement(\"div\");\r\n\t\tcontainer.style.padding = \"10px\";\r\n\t\tthis.container = container;\r\n\t\tthis.wrapper.appendChild(this.container);\r\n\t}\r\n\t\r\n\tupdate(){\r\n\t\tif (!!this.container.children.length) {\r\n\t\t\tArray.from(this.container.children).forEach(item => item.remove());\r\n\t\t}\r\n\t\tObject.keys(this.equipment).filter(k => this.equipment[k]).forEach(k => {\r\n\t\t\tlet parent = document.createElement(\"div\");\r\n\t\t\tlet key = document.createElement(\"span\");\r\n\t\t\tlet value = document.createElement(\"span\");\r\n\t\t\tkey.innerHTML = k + \": \";\r\n\t\t\tvalue.innerHTML = this.equipment[k];\r\n\t\t\tparent.appendChild(key);\r\n\t\t\tparent.appendChild(value);\r\n\t\t\tthis.container.appendChild(parent);\r\n\t\t});\r\n\t}\r\n};\n//manages the inventory UI component\r\nconst InventoryManager = class InventoryManager{\r\n\tconstructor(inventoryBox, inventory){\r\n\t\tthis.wrapper = inventoryBox;\r\n\t\tthis.inventory = inventory;\r\n\t\tlet container = document.createElement(\"div\");\r\n\t\tcontainer.style.padding = \"10px\";\r\n\t\tthis.container = container;\r\n\t\tthis.wrapper.appendChild(this.container);\r\n\t}\r\n\t\r\n\tupdate() {\r\n\t\tif (!!this.container.children.length) {\r\n\t\t\tArray.from(this.container.children).forEach(item => item.remove());\r\n\t\t}\r\n\t\tthis.inventory.forEach((item, key) => {\r\n\t\t\tlet ele = document.createElement(\"div\");\r\n\t\t\tele.innerHTML = Utils.alphabetMap[key] + \" - \" + item;\r\n\t\t\tthis.container.appendChild(ele);\r\n\t\t});\r\n\t}\r\n};\n//manages logging\r\nconst LogboxManager = class LogboxManager {\r\n\tconstructor(logbox, rowCount) {\r\n\t\tthis.logbox = logbox;\r\n\r\n\t\tthis.rowCount = rowCount;\r\n\t\tthis.rows = [];\r\n\t\tthis.messages = [];\r\n\r\n\t\tfor (let i = 0; i < this.rowCount; i++) {\r\n\t\t\tlet row = document.createElement(\"div\");\r\n\t\t\trow.className = \"logbox-row\";\r\n\t\t\trow.id = \"logbox-row-\" + (i + 1);\r\n\t\t\tthis.logbox.appendChild(row);\r\n\t\t\tthis.rows.push(row);\r\n\t\t}\r\n\t}\r\n\r\n\t//this handles inserting new messages and moving old etc\r\n\t//type is the css class used\r\n\tlog(text, type = \"default\") {\r\n\t\ttext = text.charAt(0).toUpperCase() + text.slice(1);\r\n\r\n\t\tlet msg = document.createElement(\"span\");\r\n\t\tmsg.className = \"logmsg logmsg-\" + type;\r\n\t\tmsg.innerHTML = text;\r\n\r\n\t\tthis.messages.push(msg);\r\n\r\n\t\tlet target = this.rows.find(row => row.children.length === 0);\r\n\r\n\t\tif (target) {\r\n\t\t\ttarget.appendChild(msg);\r\n\t\t} else {\r\n\t\t\tthis.rows[0].children[0].remove();\r\n\t\t\tthis.rows.forEach((row, index) => {\r\n\t\t\t\trow.appendChild(this.messages[this.messages.length - (this.rowCount - index)]);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n};\n/* \r\n@depends point.class.js\r\n@depends ../abstract/gameobject.class.js\r\n */\r\n//tiles have constant positions and they contain gameobjects\r\n//they live in TileGroups\r\n//perhaps this should extend GameObject?\r\nconst Tile = class Tile {\r\n\tconstructor(point, ...contents) {\r\n\t\tthis.position = point;\r\n\t\tthis.contents = [];\r\n\t}\r\n\r\n\t//check if tile has anything in it\r\n\tget isEmpty() {\r\n\t\treturn this.contents.length === 0;\r\n\t}\r\n\r\n\t//add object to tiles container\r\n\tadd(obj) {\r\n\t\tif (!obj instanceof GameObject) throw new TypeError(\"Added object must be of type GameObject.\");\r\n\t\tif(obj.isMoveBlocking){\r\n\t\t\tthis.contents.unshift(obj);\r\n\t\t}else{\r\n\t\t\tthis.contents.push(obj);\r\n\t\t}\r\n\t}\r\n\r\n\t//remove from tiles container\r\n\tremove(obj) {\r\n\t\tlet index = this.contents.indexOf(obj);\r\n\t\tif(index > -1){\r\n\t\t\tthis.contents.splice(index, 1);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t//get the first object in container\r\n\tget top() {\r\n\t\treturn this.contents[0];\r\n\t}\r\n\r\n\t//remove everything from container\r\n\tempty() {\r\n\t\tthis.contents = [];\r\n\t}\r\n\r\n\t//get all contents\r\n\tget get() {\r\n\t\treturn this.contents;\r\n\t}\r\n\r\n\ttoString() {\r\n\t\treturn \"Floor\";\r\n\t}\r\n};\n/* \r\n@depends globals.js\r\n@depends point.class.js\r\n@depends tile.class.js\r\n */\r\n//board, level, grid, matrix... w/e\r\n//we're calling it a TileGroup now!\r\n//it's the thing where tiles exist\r\n//empty cells are null while invalid cells are ofc undefined\r\n//todo: use some kind of EmptyTile object instead of null?\r\nconst TileGroup = class TileGroup {\r\n\tconstructor(matrix, options) {\r\n\r\n\t\t//set all options to props\r\n\t\t//kinda unsafe lol\r\n\t\tfor (let key in options) {\r\n\t\t\tthis[key] = options[key];\r\n\t\t}\r\n\r\n\t\t//check if matrix was given or do we need to generate one\r\n\t\tif (matrix) {\r\n\t\t\tthis.matrix = matrix;\r\n\t\t\tthis.w = this.matrix[0].length;\r\n\t\t\tthis.h = this.matrix.length;\r\n\t\t} else {\r\n\t\t\tthis.matrix = [];\r\n\t\t\tfor (let y = 0; y < this.h; y++) {\r\n\t\t\t\tthis.matrix[y] = [];\r\n\t\t\t\tfor (let x = 0; x < this.w; x++) {\r\n\t\t\t\t\tthis.matrix[y][x] = new Tile(new Point(x, y));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//padding and shifting\r\n\t\t//basically this just translates the matrix to \"global\" coords\r\n\t\t//padding adds empty entries to the arrays\r\n\t\t//shifting shifts them\r\n\t\tif (this.origin.x >= 0) {\r\n\t\t\t//pad x\r\n\t\t\tthis.matrix.forEach((row, y) => this.matrix[y] = Array(this.origin.x).concat(this.matrix[y]));\r\n\t\t} else {\r\n\t\t\t//shift x\r\n\t\t\tthis.matrix.forEach((row, y) => {\r\n\t\t\t\tfor (let i = 0; i < -this.origin.x; i++) {\r\n\t\t\t\t\tthis.matrix[y].shift();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (this.origin.y >= 0) {\r\n\t\t\t//pad y\r\n\t\t\tthis.matrix = Array(this.origin.y).concat(this.matrix);\r\n\t\t} else {\r\n\t\t\t//shift y\r\n\t\t\tfor (let i = 0; i < -this.origin.y; i++) {\r\n\t\t\t\tthis.matrix.shift();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//some props require defaults\r\n\t\tthis.baseColor = this.baseColor || \"slategrey\";\r\n\t\tthis.tileSize = this.tileSize || 25;\r\n\t\tthis.spacing = this.spacing || 1;\r\n\t}\r\n\r\n\t//look up each cell and update gameobject positions in tiles\r\n\tupdate() {\r\n\t\tthis.matrix.forEach((row, y) => row.forEach((tile, x) => {\r\n\t\t\tif (tile && !tile.isEmpty) {\r\n\t\t\t\tlet temp = tile.top;\r\n\t\t\t\ttile.contents.shift();\r\n\t\t\t\tthis.insert(temp);\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n\r\n\t//insert gameobject\r\n\tinsert(obj) {\r\n\t\tlet [x, y] = obj.position.get;\r\n\t\tif (this.has(obj.position)) {\r\n\t\t\tthis.matrix[y][x].add(obj);\r\n\t\t}\r\n\t}\r\n\r\n\t//returns the real coordinates and size of the matrix\r\n\tget bounds() {\r\n\t\treturn {\r\n\t\t\tx: this.origin.x * (this.tileSize + this.spacing),\r\n\t\t\ty: this.origin.y * (this.tileSize + this.spacing),\r\n\t\t\tw: this.w * (this.tileSize + this.spacing) - this.spacing,\r\n\t\t\th: this.h * (this.tileSize + this.spacing) - this.spacing\r\n\t\t};\r\n\t}\r\n\r\n\t//remove gameobject\r\n\tremove(obj) {\r\n\t\tlet [x, y] = obj.position.get;\r\n\t\tif (this.has(obj.position)) {\r\n\t\t\tthis.matrix[y][x].remove(obj);\r\n\t\t}\r\n\t}\r\n\r\n\t//empty all tiles\r\n\tclear() {\r\n\t\tthis.matrix.forEach(row => row.forEach(tile => tile.empty()));\r\n\t}\r\n\r\n\t//check if point exists in matrix\r\n\thas(point) {\r\n\t\tlet [x, y] = point.get;\r\n\t\treturn (!!this.matrix[y] && !!this.matrix[y][x]);\r\n\t}\r\n\r\n\t//get tile at point\r\n\tget(point) {\r\n\t\tlet [x, y] = point.get;\r\n\t\treturn this.has(point) ? this.matrix[y][x] : undefined;\r\n\t}\r\n\r\n\t//go through matrix and draw each cell\r\n\tdraw() {\r\n\t\tthis.matrix.forEach((row, y) => row.forEach((tile, x) => {\r\n\t\t\tif (tile) {\r\n\t\t\t\tlet [tx, ty] = tile.position.get;\r\n\t\t\t\tif (tile.isEmpty) {\r\n\t\t\t\t\t//default\r\n\t\t\t\t\tmainCtx.fillStyle = this.baseColor;\r\n\t\t\t\t\tmainCtx.fillRect(\r\n\t\t\t\t\t\ttx * (this.tileSize + this.spacing),\r\n\t\t\t\t\t\tty * (this.tileSize + this.spacing),\r\n\t\t\t\t\t\tthis.tileSize,\r\n\t\t\t\t\t\tthis.tileSize\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//draw gameobject\r\n\t\t\t\t\tmainCtx.fillStyle = tile.top.bgColor;\r\n\t\t\t\t\tmainCtx.fillRect(\r\n\t\t\t\t\t\ttx * (this.tileSize + this.spacing),\r\n\t\t\t\t\t\tty * (this.tileSize + this.spacing),\r\n\t\t\t\t\t\tthis.tileSize,\r\n\t\t\t\t\t\tthis.tileSize\r\n\t\t\t\t\t);\r\n\t\t\t\t\tmainCtx.fillStyle = tile.top.color;\r\n\t\t\t\t\tmainCtx.fillText(\r\n\t\t\t\t\t\ttile.top.glyph,\r\n\t\t\t\t\t\ttx * (this.tileSize + this.spacing) + this.tileSize / 2,\r\n\t\t\t\t\t\tty * (this.tileSize + this.spacing) + this.tileSize / 1.5\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}));\r\n\t}\r\n};\n/* @depends ../abstract/gameobject.class.js */\r\nconst Corpse = class Corpse extends GameObject {\r\n\tconstructor(position){\r\n\t\tsuper(position);\r\n\t\tthis.bgColor = \"hsl(0,40%,40%)\";\r\n\t\tthis.glyph = \"x\"; //some block character\r\n\t\tthis.color = \"hsl(0,40%,10%)\";\r\n\t\tthis.flavorName = \"corpse\";\r\n\t}\r\n\t\r\n\tupdate(){\r\n\t\treturn 0;\r\n\t}\r\n};\n/*\r\n@depends ../../abstract/action.class.js\r\n@depends ../objs/corpse.class.js\r\n*/\r\nconst AttackAction = class AttackAction extends Action {\r\n\tconstructor(context, logger, direction) {\r\n\t\tsuper(context, logger);\r\n\t\tthis.direction = direction;\r\n\t}\r\n\r\n\ttry (actor, time) {\r\n\t\tthis.duration = actor.equipment.weapon.speed;\r\n\t\tif(time % this.duration !== 0){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tlet target = new Point(...actor.position.get);\r\n\t\ttarget.moveBy(this.direction);\r\n\t\t\r\n\t\tlet tile = this.context.get(target);\r\n\t\treturn tile && tile.top && tile.top.isHittable && actor.isAlive;\r\n\t}\r\n\r\n\tdo(actor) {\r\n\t\tlet target = new Point(...actor.position.get);\r\n\t\ttarget.moveBy(this.direction);\r\n\t\ttarget = this.context.get(target);\r\n\t\t\r\n\t\tif(!actor.equipment.weapon){\r\n\t\t\tactor.equipment.weapon = Utils.defaults.weapon();\r\n\t\t}\r\n\t\t\r\n\t\tlet damage = Math.max(actor.equipment.weapon.damage - target.top.stats.AC, 0);\r\n\t\t\r\n\t\tif(this.logger){\r\n\t\t\tthis.logger.log(`${actor.flavorName} hit ${target.top.flavorName} for ${damage} damage with ${actor.equipment.weapon}`, (actor.constructor === Player ? \"hit\" : \"damage\"));\r\n\t\t}\r\n\t\tlet died = target.top.takeDamage(damage, this.logger);\r\n\t\tif (died) {\r\n\t\t\t//drop all items and corpse\r\n\t\t\ttarget.top.items.forEach(item => {\r\n\t\t\t\tif(item.canDrop){\r\n\t\t\t\t\titem.position = new Point(...target.top.position.get);\r\n\t\t\t\t\ttarget.add(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\ttarget.add(new Corpse(new Point(...target.top.position.get)));\r\n\t\t\ttarget.remove(target.top);\r\n\t\t}\r\n\t\tthis.context.update();\r\n\t\treturn this.duration;\r\n\t}\r\n};\n/* @depends ../../abstract/action.class.js */\r\nconst ItemDropAction = class ItemDropAction extends Action {\r\n\tconstructor(context, logger, inventorySlot){\r\n\t\tsuper(context, logger);\r\n\t\tthis.inventorySlot = inventorySlot;\r\n\t}\r\n\t\r\n\ttry(actor, time){\r\n\t\tlet hasItem = !!actor.inventory[Utils.alphabetMap.indexOf(this.inventorySlot)];\r\n\t\tif(!hasItem){\r\n\t\t\tthis.logger.log(\"No such item\");\r\n\t\t}\r\n\t\treturn time % 10 === 0 && hasItem && actor.isAlive;\r\n\t}\r\n\t\r\n\tdo(actor){\r\n\t\tlet index = Utils.alphabetMap.indexOf(this.inventorySlot),\r\n\t\t\titem = actor.inventory[index];\r\n\t\tactor.inventory.splice(index, 1);\r\n\t\titem.position = new Point(...actor.position.get);\r\n\t\tthis.context.insert(item);\r\n\t\tthis.logger.log(actor.flavorName + \" dropped \" + item.toString());\r\n\t\treturn 10;\r\n\t}\r\n};\n/* @depends ../../abstract/action.class.js */\r\nconst ItemEquipAction = class ItemEquipAction extends Action {\r\n\tconstructor(context, logger, inventorySlot){\r\n\t\tsuper(context, logger);\r\n\t\tthis.inventorySlot = inventorySlot;\r\n\t}\r\n\t\r\n\ttry(actor, time){\r\n\t\tlet hasItem = !!actor.inventory[Utils.alphabetMap.indexOf(this.inventorySlot)];\r\n\t\tif(!hasItem){\r\n\t\t\tthis.logger.log(\"No such item\");\r\n\t\t}\r\n\t\treturn time % 10 === 0 && hasItem && actor.isAlive;\r\n\t}\r\n\t\r\n\tdo(actor){\r\n\t\tlet inventoryIndex = Utils.alphabetMap.indexOf(this.inventorySlot),\r\n\t\t\titem = actor.inventory[inventoryIndex];\r\n\t\t\t\r\n\t\t//if already has something equipped in that slot\r\n\t\t//remove it into inventory\r\n\t\t//actually this should be an unequipaction\r\n\t\tif(actor.equipment[item.slot]){\r\n\t\t\tactor.inventory.push(actor.equipment[item.slot]);\r\n\t\t\tactor.equipment[item.slot] = null;\r\n\t\t}\r\n\t\t//splice item from inventory and put it in equipment\r\n\t\titem = actor.inventory.splice(inventoryIndex, 1)[0];\r\n\t\tactor.equipment[item.slot] = item;\r\n\t\t\r\n\t\tthis.logger.log(actor.flavorName + \" equipped \" + item.toString());\r\n\t\treturn 10;\r\n\t}\r\n};\n/* @depends ../../abstract/action.class.js */\r\nconst ItemPickupAction = class ItemPickupAction extends Action {\r\n\tconstructor(context, logger){\r\n\t\tsuper(context, logger);\r\n\t}\r\n\t\r\n\ttry(actor, time){\r\n\t\treturn time % 10 === 0 && actor.inventory.length < actor.stats.inventorySize && this.context.get(actor.position).contents.some(obj => obj instanceof Item) && actor.isAlive;\r\n\t}\r\n\t\r\n\tdo(actor){\r\n\t\tlet targetTile = this.context.get(actor.position),\r\n\t\t\titem = targetTile.contents.find(obj => obj instanceof Item);\r\n\t\tactor.inventory.push(item);\r\n\t\ttargetTile.remove(item);\r\n\t\tif(this.logger){\r\n\t\t\tthis.logger.log(actor.flavorName + \" picked up \" + item.toString());\r\n\t\t}\r\n\t\treturn 10;\r\n\t}\r\n};\n/* @depends ../../abstract/action.class.js */\r\n//the act of moving something somewhere\r\n//menu logic not done yet but maybe this could be used for menus too\r\nconst MoveAction = class MoveAction extends Action {\r\n\tconstructor(context, logger, movement) {\r\n\t\tsuper(context, logger);\r\n\t\tthis.movement = movement;\r\n\t}\r\n\r\n\ttry (actor, time) {\r\n\t\tthis.duration = actor.stats.moveSpeed;\r\n\t\tif(time % this.duration !== 0){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t//check if the point we're trying to move to is empty\r\n\t\tlet target = new Point(...actor.position.get);\r\n\t\ttarget.moveBy(this.movement);\r\n\t\tlet tile = this.context.get(target);\r\n\t\treturn (tile.isEmpty || (tile && tile.top && !tile.top.isMoveBlocking)) && actor.isAlive;\r\n\t}\r\n\r\n\tdo(actor) {\r\n\t\tactor.position.moveBy(this.movement);\r\n\t\tthis.context.update(); //this is kinda important, should this even be here\r\n\t\treturn this.duration;\r\n\t}\r\n};\n/* @depends ../../abstract/action.class.js */\r\n//doesnt do anything\r\nconst NullAction = class NullAction extends Action {\r\n\tconstructor(context, logger) {\r\n\t\tsuper(context, logger);\r\n\t}\r\n\r\n\ttry (actor, time) {\r\n\t\treturn time % 10 === 0;\r\n\t}\r\n\r\n\tdo(actor) {\r\n\t\treturn 10;\r\n\t}\r\n};\n/* @depends ../../abstract/action.class.js */\r\nconst StairAction = class StairAction extends Action {\r\n\tconstructor(context, logger){\r\n\t\tsuper(context, logger);\r\n\t}\r\n\t\r\n\ttry(actor, time){\r\n\t\tlet tile = this.context.get(actor.position),\r\n\t\t\tisStair = tile && tile.contents.some(obj => obj.constructor === Stair);\r\n\t\tif(!isStair){\r\n\t\t\tthis.logger.log(\"No stairs here\");\r\n\t\t}\r\n\t\treturn time % 10 === 0 && isStair && actor.isAlive;\r\n\t}\r\n\t\r\n\tdo(actor){\r\n\t\tlet stair = this.context.get(actor.position).contents.find(obj => obj.constructor === Stair);\r\n\t\tactor.dungeonLevelChange = stair.direction;\r\n\t\tthis.logger.log(actor.flavorName + \" went \" + stair.direction + \" the stairs\");\r\n\t\treturn 10;\r\n\t}\r\n};\n/* \r\n@depends ../core/vector.class.js\r\n@depends ../core/tilegroup.class.js\r\n@depends ../core/point.class.js\r\n@depends ../logic/actions/attackaction.class.js\r\n@depends itemdropaction.class.js\r\n@depends itemequipaction.class.js\r\n@depends itempickupaction.class.js\r\n@depends moveaction.class.js\r\n@depends nullaction.class.js\r\n@depends stairaction.class.js\r\n */\r\n//does gamelogic stuff\r\nconst ActionManager = class ActionManager {\r\n\tconstructor(board, logger) {\r\n\t\tthis.board = board;\r\n\t\tthis.logger = logger;\r\n\r\n\t\tthis.proposalMap = {};\r\n\t\tthis.proposalMap[null] = [NullAction];\r\n\t\tthis.proposalMap[Vector] = [MoveAction, AttackAction, NullAction];\r\n\t\tthis.proposalMap[\"pickup\"] = [ItemPickupAction, NullAction];\r\n\t\tthis.proposalMap[\"drop\"] = [ItemDropAction, NullAction];\r\n\t\tthis.proposalMap[\"equip\"] = [ItemEquipAction, NullAction];\r\n\t\tthis.proposalMap[\"stair\"] = [StairAction, NullAction];\r\n\t}\r\n\r\n\t//decide actor logic\r\n\tthink(actor, player) {\r\n\t\tif (actor instanceof Enemy) {\r\n\t\t\tlet fov = this.getFov(actor),\r\n\t\t\t\tinstruction = null,\r\n\t\t\t\tshouldLog = this.getFov(player).has(actor.position);\r\n\t\t\tactor.target = fov.get(player.position);\r\n\r\n\t\t\tif (!actor.target || !player.isAlive) {\r\n\t\t\t\t//cant find target, move randomly\r\n\t\t\t\tinstruction = new Vector();\r\n\t\t\t\tactor.noticed = false;\r\n\t\t\t} else if (Point.equal(actor.position, actor.target.position)) {\r\n\t\t\t\t//reached target, stopping\r\n\t\t\t\tactor.target = undefined;\r\n\t\t\t\treturn;\r\n\t\t\t} else {\r\n\t\t\t\t//moving towards target\r\n\t\t\t\tlet vector = Point.distance(actor.position, actor.target.position);\r\n\t\t\t\tvector.reduce();\r\n\t\t\t\tinstruction = vector;\r\n\t\t\t\tif (!actor.noticed && shouldLog) this.logger.log(actor.flavorName + \" noticed \" + player.flavorName);\r\n\t\t\t\tactor.noticed = true;\r\n\t\t\t}\r\n\r\n\t\t\tlet proposals = this.proposalMap[instruction.constructor];\r\n\t\t\tif (proposals) {\r\n\t\t\t\tlet methods = proposals.map(action => () => new action(this.board, (shouldLog ? this.logger : null), instruction));\r\n\t\t\t\tactor.actions.push(methods);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetFov(actor) {\r\n\t\tif(!actor)return;\r\n\t\tlet [ax, ay] = actor.position.get,\r\n\t\t\trange = actor.stats.viewDistance,\r\n\t\t\tquarters = {\r\n\t\t\t\t\"ne\": [],\r\n\t\t\t\t\"se\": [],\r\n\t\t\t\t\"sw\": [],\r\n\t\t\t\t\"nw\": []\r\n\t\t\t};\r\n\r\n\t\tfor (let y = 0; y < range; y++) {\r\n\t\t\tfor (let x = 0; x < range; x++) {\r\n\t\t\t\tif (!quarters.ne[y]) {\r\n\t\t\t\t\tquarters.ne[y] = [];\r\n\t\t\t\t\tquarters.se[y] = [];\r\n\t\t\t\t\tquarters.sw[y] = [];\r\n\t\t\t\t\tquarters.nw[y] = [];\r\n\t\t\t\t}\r\n\t\t\t\tquarters.ne[y][x] = this.board.get(new Point(ax + x, ay - range + y + 1));\r\n\t\t\t\tquarters.se[y][x] = this.board.get(new Point(ax + x, ay + y));\r\n\t\t\t\tquarters.sw[y][x] = this.board.get(new Point(ax - range + x + 1, ay + y));\r\n\t\t\t\tquarters.nw[y][x] = this.board.get(new Point(ax - range + x + 1, ay - range + y + 1));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tquarters.ne = Utils.rotate(Utils.beamcast(Utils.rotate(quarters.ne, 90)), -90);\r\n\t\tquarters.se = Utils.beamcast(quarters.se);\r\n\t\tquarters.sw = Utils.rotate(Utils.beamcast(Utils.rotate(quarters.sw, -90)), 90);\r\n\t\tquarters.nw = Utils.rotate(Utils.beamcast(Utils.rotate(quarters.nw, 180)), -180);\r\n\r\n\t\treturn new TileGroup(Utils.mergeQuarters(quarters), {\r\n\t\t\torigin: new Point(ax - range + 1, ay - range + 1),\r\n\t\t\tbaseColor: TILE_COLOR,\r\n\t\t\ttileSize: 25,\r\n\t\t\tspacing: 1\r\n\t\t});\r\n\t}\r\n\r\n\t//what does this do again? give actions to actors? or just the player?\r\n\tdelegateAction(actor, instruction) {\r\n\t\tif(!actor){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!actor.isAlive){\r\n\t\t\tlet proposals = this.proposalMap[null];\r\n\t\t\tlet methods = proposals.map(action => () => new action(this.board, this.logger, instruction));\r\n\t\t\tactor.actions.push(methods);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif (instruction) {\r\n\t\t\tlet key = instruction;\r\n\t\t\tif(typeof instruction === \"function\"){\r\n\t\t\t\tinstruction = instruction();\r\n\t\t\t\tkey = instruction.constructor;\r\n\t\t\t}else if(typeof instruction === \"string\"){\r\n\t\t\t\t[key, instruction] = instruction.split(\":\");\r\n\t\t\t\tif(key === \"drop\" && !instruction){\r\n\t\t\t\t\tthis.logger.log(\"Which item to drop? [a-z]\");\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}else if(key === \"equip\" && !instruction){\r\n\t\t\t\t\tthis.logger.log(\"Which item to equip? [a-z]\");\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet proposals = this.proposalMap[key];\r\n\t\t\tif (proposals) {\r\n\t\t\t\tlet methods = proposals.map(action => () => new action(this.board, this.logger, instruction));\r\n\t\t\t\tactor.actions.push(methods);\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn(\"Could not delegate action: \", instruction, JSON.stringify(instruction));\r\n\t\t\t}\r\n\t\t} else if (instruction === null) {\r\n\t\t\tactor.actions.push([() => new NullAction(null, this.logger)]);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n};\n/* \r\n@depends globals.js\r\n@depends ../ui/equipmentmanager.class.js\r\n@depends ../ui/inventorymanager.class.js\r\n@depends ../ui/logboxmanager.class.js\r\n@depends ../misc/utils.class.js\r\n@depends ../logic/actionmanager.class.js\r\n@depends ../control/keyhandler.class.js\r\n@depends ../controls/mousehandler.class.js\r\n */\r\n//the game\r\nconst Game = class Game {\r\n\tconstructor(board, dungeon) {\r\n\t\t\r\n\t\tthis.logger = new LogboxManager(document.getElementById(\"logbox\"), 10);\r\n\r\n\t\t//global gametime\r\n\t\tthis.time = 0;\r\n\t\t\r\n\t\tthis.currentDungeonLevel = 0;\r\n\t\tthis.dungeonLevels = [];\r\n\t\t\r\n\t\tthis.board = board;\r\n\t\tthis.player = dungeon.objs[0];\r\n\t\t\r\n\t\t//map objs argument into this.objs by the objs creation id\r\n\t\t//this.objs = [];\r\n\t\t//objs.forEach(obj => this.objs[obj.id] = obj);\r\n\t\t\r\n\t\tthis.saveDungeonLevel(dungeon);\r\n\r\n\t\tthis.logic = new ActionManager(this.board, this.logger);\r\n\r\n\t\t//keypress eventlistener\r\n\t\tthis.keyHandler = new KeyHandler();\r\n\t\tdocument.addEventListener(\"keydown\", e => {\r\n\t\t\tif (this.logic.delegateAction(this.player, this.keyHandler.get(e.which))) {\r\n\t\t\t\tthis.update();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tlet miscOtherInfoContainer = document.getElementById(\"info-container-other-misc\");\r\n\t\t\r\n\t\tthis.examineContainer = document.createElement(\"div\");\r\n\t\tthis.examineContainer.style.padding = \"10px\";\r\n\t\t\r\n\t\tmiscOtherInfoContainer.appendChild(this.examineContainer);\r\n\r\n\t\t//cleaned this up a bit but it's still not very nice\r\n\t\tthis.mouseHandler = new MouseHandler(this.board);\r\n\t\tdocument.addEventListener(\"mousemove\", e => {\r\n\t\t\tlet bounds = this.board.bounds;\r\n\t\t\tlet screenPoint = new Point(e.pageX, e.pageY);\r\n\t\t\t\r\n\t\t\t//mouse is inside game screen\r\n\t\t\tif (screenPoint.in(bounds)) {\r\n\t\t\t\tlet fov = this.player.fov,\r\n\t\t\t\t\tgamePoint = Utils.screenToGame(screenPoint, this.board.tileSize, this.board.spacing);\r\n\t\t\t\t\t\r\n\t\t\t\t//set cursor position\r\n\t\t\t\tthis.mouseHandler.cursorFromScreen(screenPoint);\r\n\t\t\t\t\t\r\n\t\t\t\t//if hovering over a tile that is seen\r\n\t\t\t\tif(fov && fov.has(gamePoint)){\r\n\t\t\t\t\tlet targetTile = this.board.get(gamePoint);\r\n\t\t\t\t\t\r\n\t\t\t\t\t//if tile is not empty\r\n\t\t\t\t\tif (targetTile && targetTile.top) {\r\n\t\t\t\t\t\t//reset all lifebars styles\r\n\t\t\t\t\t\tthis.dungeonLevels[this.currentDungeonLevel].objs.forEach(obj => {\r\n\t\t\t\t\t\t\tif (obj.lifebar) obj.lifebar.setStyle(\"default\");\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t//set examine text\r\n\t\t\t\t\t\tthis.examineContainer.innerHTML = targetTile.top;\r\n\t\t\t\t\t\t//highlight lifebar\r\n\t\t\t\t\t\tif (targetTile.top instanceof Creature) {\r\n\t\t\t\t\t\t\ttargetTile.top.lifebar.setStyle(\"hilight\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.examineContainer.innerHTML = targetTile;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//tile is not in fov\r\n\t\t\t\t\tthis.examineContainer.innerHTML = \"You can't see that\";\r\n\t\t\t\t}\r\n\t\t\t\t//hovering over a lifebar\r\n\t\t\t} else if (e.target.classList.contains(\"bar-lifebar\")) {\r\n\t\t\t\t//reset all lifebars styles\r\n\t\t\t\tthis.dungeonLevels[this.currentDungeonLevel].objs.forEach(obj => {\r\n\t\t\t\t\tif (obj.lifebar) obj.lifebar.setStyle(\"default\");\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t//get lifebars owner\r\n\t\t\t\tlet id = e.target.id.match(/[0-9]+$/);\r\n\t\t\t\tlet target = this.dungeonLevels[this.currentDungeonLevel].objs[Number(id)];\r\n\r\n\t\t\t\t//set cursor to lifebars owner\r\n\t\t\t\tif (target) {\r\n\t\t\t\t\tthis.mouseHandler.cursorFromGame(target.position);\r\n\t\t\t\t\tthis.examineContainer.innerHTML = target;\r\n\t\t\t\t\ttarget.lifebar.setStyle(\"hilight\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tthis.inventoryManager = new InventoryManager(document.getElementById(\"info-container-inventory\"), this.player.inventory);\r\n\t\tthis.equipmentManager = new EquipmentManager(document.getElementById(\"info-container-equipment\"), this.player.equipment);\r\n\t}\r\n\t\r\n\tsaveDungeonLevel(dungeon){\r\n\t\tlet {rooms, paths, objs} = dungeon,\r\n\t\t\timg = new Image();\r\n\t\t\timg.src = secondCanvas.toDataURL();\r\n\t\tthis.dungeonLevels[this.currentDungeonLevel] = {\r\n\t\t\tobjs: [],\r\n\t\t\trooms: rooms,\r\n\t\t\tpaths: paths,\r\n\t\t\tmap: img\r\n\t\t};\r\n\t\tobjs.forEach(obj => this.dungeonLevels[this.currentDungeonLevel].objs[obj.id] = obj);\r\n\t}\r\n\t\r\n\tchangeDungeonLevel(level){\r\n\t\tthis.saveDungeonLevel(this.dungeonLevels[this.currentDungeonLevel]);\r\n\t\tlet dir = level > this.currentDungeonLevel ? \"down\" : \"up\";\r\n\t\t\r\n\t\tthis.dungeonLevels[this.currentDungeonLevel].objs.forEach((obj,k) => {\r\n\t\t\tif(k === 0){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(obj.lifebar){\r\n\t\t\t\tobj.lifebar.remove();\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tthis.currentDungeonLevel = level;\r\n\t\t\r\n\t\tmainCtx.clearRect(0, 0, w, h);\r\n\t\tsecondCtx.clearRect(0, 0, w, h);\r\n\t\tthis.board.clear();\r\n\t\t\r\n\t\tlet objs = [];\r\n\t\tobjs[0] = this.player;\r\n\t\t//if level already exists load it else generate new\r\n\t\tif(this.dungeonLevels[level]){\r\n\t\t\tobjs = this.dungeonLevels[level].objs;\r\n\t\t\tsecondCtx.drawImage(this.dungeonLevels[level].map, 0, 0);\r\n\t\t\t//put player in the last room if we're going up\r\n\t\t\tif(dir === \"up\"){\r\n\t\t\t\tthis.player.position.set(\r\n\t\t\t\t\tthis.dungeonLevels[level].rooms[this.dungeonLevels[level].rooms.length-1].x+1,\r\n\t\t\t\t\tthis.dungeonLevels[level].rooms[this.dungeonLevels[level].rooms.length-1].y+1\r\n\t\t\t\t);\r\n\t\t\t}else{\r\n\t\t\t\t//or in the first room\r\n\t\t\t\tthis.player.position.set(\r\n\t\t\t\t\tthis.dungeonLevels[level].rooms[0].x+1,\r\n\t\t\t\t\tthis.dungeonLevels[level].rooms[0].y+1\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tlet options = Utils.DungeonGenerator.defaultOptions;\r\n\t\t\toptions.stairs.up = true;\r\n\t\t\tlet dungeon = Utils.DungeonGenerator.makeLevel(this.player, options);\r\n\t\t\tobjs = dungeon.objs;\r\n\t\t\tthis.dungeonLevels[level] = {\r\n\t\t\t\tobjs: [],\r\n\t\t\t\trooms: dungeon.rooms,\r\n\t\t\t\tpaths: dungeon.paths\r\n\t\t\t};\r\n\t\t}\r\n\t\t\r\n\t\t//put objs in their id slots\r\n\t\tobjs.forEach(obj => this.dungeonLevels[level].objs[obj.id] = obj);\r\n\t\t\r\n\t\t//insert objs into the board\r\n\t\tthis.dungeonLevels[level].objs.forEach(obj => {\r\n\t\t\tif (obj) {\r\n\t\t\t\tthis.board.insert(obj);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tthis.dungeonLevels[level].objs.forEach(obj => {\r\n\t\t\tif (obj) {\r\n\t\t\t\tthis.logic.think(obj, this.player);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tlet duration = this.player.update(this.logger);\r\n\t\tlet tickCount = duration / TICK;\r\n\t\t\r\n\t\tif(this.player.dungeonLevelChange){\r\n\t\t\tlet level = this.currentDungeonLevel;\r\n\t\t\tif(this.player.dungeonLevelChange === \"up\"){\r\n\t\t\t\tlevel--;\r\n\t\t\t}else if(this.player.dungeonLevelChange === \"down\"){\r\n\t\t\t\tlevel++;\r\n\t\t\t}\r\n\t\t\tthis.changeDungeonLevel(level);\r\n\t\t\t\r\n\t\t\tdelete this.player.dungeonLevelChange;\r\n\t\t}else if(!this.player.isAlive){\r\n\t\t\tthis.board.remove(this.player);\r\n\t\t}\r\n\t\t\r\n\t\t//contains the total durations of each objs actions for this turn\r\n\t\tlet objDurations = [];\r\n\t\tfor(let i = 0; i < tickCount; i++){\r\n\t\t\tthis.time += TICK;\r\n\t\t\t\r\n\t\t\tthis.dungeonLevels[this.currentDungeonLevel].objs.forEach((obj, index) => {\r\n\t\t\t\t//skip player\r\n\t\t\t\tif(obj.type === \"Player\"){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(obj.isAlive){\r\n\t\t\t\t\tlet duration = obj.update(this.logger, this.time + (objDurations[obj.id] || 0));\r\n\t\t\t\t\tif(duration > 0){\r\n\t\t\t\t\t\t//if action was excecuted we generate new ones and\r\n\t\t\t\t\t\t//forward the time for this obj\r\n\t\t\t\t\t\tthis.logic.think(obj, this.player);\r\n\t\t\t\t\t\tobjDurations[obj.id] = objDurations[obj.id] ? objDurations[obj.id] + duration : duration;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t//obj died during update\r\n\t\t\t\t\tif(!obj.isAlive){\r\n\t\t\t\t\t\tthis.board.remove(obj);\r\n\t\t\t\t\t\tdelete this.dungeonLevels[this.currentDungeonLevel].objs[obj.id];\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.board.remove(obj);\r\n\t\t\t\t\tdelete this.dungeonLevels[this.currentDungeonLevel].objs[obj.id];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tlet fov = this.logic.getFov(this.player);\r\n\t\tthis.player.fov = fov;\r\n\t\t\r\n\t\tif(fov){\r\n\t\t\tthis.dungeonLevels[this.currentDungeonLevel].objs.forEach(obj => {\r\n\t\t\t\tif(obj instanceof Enemy){\r\n\t\t\t\t\tif(fov.has(obj.position)){\r\n\t\t\t\t\t\tobj.lifebar.show();\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tobj.lifebar.hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tmainCtx.clearRect(0, 0, w, h);\r\n\t\t\tfov.draw();\r\n\t\t\tsecondCtx.drawImage(mainCanvas, 0, 0);\r\n\t\t}\r\n\r\n\t\tthis.inventoryManager.update();\r\n\t\tthis.equipmentManager.update();\r\n\t}\r\n\r\n\tstart() {\r\n\t\t\r\n\t\tthis.logger.log(\"Hello and welcome\", \"hilight\");\r\n\t\tthis.dungeonLevels[this.currentDungeonLevel].objs.forEach(obj => {\r\n\t\t\tif (obj) {\r\n\t\t\t\tthis.board.insert(obj);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tlet fov = this.logic.getFov(this.player);\r\n\t\tthis.player.fov = fov;\r\n\t\t\r\n\t\tthis.dungeonLevels[this.currentDungeonLevel].objs.forEach(obj => {\r\n\t\t\tthis.logic.think(obj, this.player);\r\n\t\t\tif(obj instanceof Enemy){\r\n\t\t\t\tif(fov.has(obj.position)){\r\n\t\t\t\t\tobj.lifebar.show();\r\n\t\t\t\t}else{\r\n\t\t\t\t\tobj.lifebar.hide();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tfov.draw();\r\n\t\tthis.inventoryManager.update();\r\n\t\tthis.equipmentManager.update();\r\n\t\t\r\n\t\tdocument.getElementById(\"loader\").remove();\r\n\t}\r\n};\n/* @depends ../abstract/creature.class.js */\r\nconst Player = class Player extends Creature {\r\n\tconstructor(position, stats) {\r\n\t\tsuper(position, stats);\r\n\t\tthis.actions = [];\r\n\t\tthis.bgColor = \"white\";\r\n\t\tthis.glyph = \"@\";\r\n\t\tthis.color = \"black\";\r\n\r\n\t\tthis.stats.maxHP = 50;\r\n\t\tthis.stats.HP = 50;\r\n\t\tthis.stats.viewDistance = 8;\r\n\t\tthis.stats.moveSpeed = 10;\r\n\t\t//this.stats.inventorySize = 15;\r\n\t\t\r\n\t\tthis.stats = stats || this.stats;\r\n\t\t\r\n\t\tthis.equipment.head = new Armor(\"head\", \"Bronze helmet\", 1);\r\n\t\t\r\n\t\tthis.equipment.weapon = new Weapon(\"Blunt Dagger\", 1, 5);\r\n\r\n\t\tthis.lifebar = new Lifebar(this.id, \"Hero\", document.getElementById(\"info-container-player\"), this.stats.maxHP, this.stats.HP);\r\n\t\tthis.flavorName = \"you\";\r\n\t\tthis.flavor = \"Hi mom!\";\r\n\t\t//todo: store username here?\r\n\t}\r\n};\n/*\r\n@depends ../core/game.class.js\r\n@depends ../objs/player.class.js\r\n*/\r\n\r\nvar game = new Game(\r\n\tnew TileGroup(null, {\r\n\t\torigin: new Point(0, 0),\r\n\t\tbaseColor: \"slategrey\",\r\n\t\ttileSize: 25,\r\n\t\tspacing: 1,\r\n\t\tw: 40,\r\n\t\th: 20\r\n\t}), Utils.loadGame() || Utils.DungeonGenerator.makeLevel(new Player(new Point(10,10)))\r\n);\r\nUtils.initUIButtons(game);\r\n\r\nif (env === \"dev\") {\r\n\tUtils.exportObjs(Utils.exports);\r\n} else if (env === \"prod\") {\r\n\r\n} else {\r\n\tthrow new TypeError(\"Invalid environment\");\r\n}\r\n\r\ngame.start();\n(function() {\n\tvar elems = Array.from(document.querySelectorAll(\".moveable, .resizeable\"));\n\n\tvar dragging = false,\n\t\tselected,\n\t\telemX = 0,\n\t\telemY = 0;\n\n\telems.forEach(elem => {\n\t\tlet right = document.createElement(\"div\"),\n\t\t\tbottom = document.createElement(\"div\");\n\t\tright.classList.add(\"edge\");\n\t\tbottom.classList.add(\"edge\");\n\n\t\tright.classList.add(\"edge-right\");\n\t\tbottom.classList.add(\"edge-bottom\");\n\n\t\tif (elem.classList.contains(\"moveable\")) {\n\t\t\tfunction move(e){\n\t\t\t\te.stopPropagation();\n\t\t\t\t//e.cancelBubble();\n\t\t\t\te.preventDefault();\n\t\t\t\tlet x = e.pageX;\n\t\t\t\tlet y = e.pageY;\n\t\t\t\tif(x === undefined){\n\t\t\t\t\tx = e.touches[0].pageX;\n\t\t\t\t\ty = e.touches[0].pageY;\n\t\t\t\t}\n\t\t\t\telemX = x - elem.offsetLeft;\n\t\t\t\telemY = y - elem.offsetTop;\n\t\t\t\tdragging = \"body\";\n\t\t\t\tselected = elem;\n\t\t\t}\n\t\t\telem.addEventListener(\"mousedown\", move);\n\t\t\telem.addEventListener(\"touchstart\", move);\n\t\t}\n\n\t\tif (elem.classList.contains(\"resizeable\")) {\n\t\t\tfunction startr(e){\n\t\t\t\te.stopPropagation();\n\t\t\t\t//e.cancelBubble();\n\t\t\t\te.preventDefault();\n\t\t\t\tdragging = \"right\";\n\t\t\t\tselected = elem;\n\t\t\t}\n\t\t\t\n\t\t\tfunction startb(e){\n\t\t\t\te.stopPropagation();\n\t\t\t\t//e.cancelBubble();\n\t\t\t\te.preventDefault();\n\t\t\t\tdragging = \"bottom\";\n\t\t\t\tselected = elem;\n\t\t\t}\n\t\t\t\n\t\t\tbottom.addEventListener(\"mousedown\", startb);\n\t\t\tbottom.addEventListener(\"touchstart\", startb);\n\t\t\tright.addEventListener(\"mousedown\", startr);\n\t\t\tright.addEventListener(\"touchstart\", startr);\n\n\t\t\telem.appendChild(right);\n\t\t\telem.appendChild(bottom);\n\t\t}\n\t});\n\t\n\tfunction gmove(e){\n\t\t//e.preventDefault();\n\t\tif (dragging && selected) {\n\t\t\tlet x = e.pageX;\n\t\t\tlet y = e.pageY;\n\t\t\tif(x === undefined){\n\t\t\t\tx = e.touches[0].pageX;\n\t\t\t\ty = e.touches[0].pageY;\n\t\t\t}\n\t\t\tif (dragging === \"right\") {\n\t\t\t\tselected.style.width = selected.offsetWidth + (x - selected.offsetWidth) - selected.offsetParent.offsetLeft - selected.offsetLeft + \"px\";\n\t\t\t} else if (dragging === \"bottom\") {\n\t\t\t\tselected.style.height = selected.offsetHeight + (y - selected.offsetHeight) - selected.offsetParent.offsetTop - selected.offsetTop + \"px\";\n\t\t\t} else if (dragging === \"body\") {\n\t\t\t\tselected.style.top = y - elemY + \"px\";\n\t\t\t\tselected.style.left = x - elemX + \"px\";\n\t\t\t}\n\t\t}\n\t}\n\t\n\tdocument.addEventListener(\"mousemove\", gmove);\n\tdocument.addEventListener(\"touchmove\", gmove);\n\t\n\tfunction end(e){\n\t\te.stopPropagation();\n\t\t//e.cancelBubble();\n\t\t//e.preventDefault();\n\t\tdragging = false;\n\t\tselected = undefined;\n\t}\n\t\n\tdocument.addEventListener(\"mouseup\", end);\n\tdocument.addEventListener(\"touchend\", end);\n})();\n}(window));"]}